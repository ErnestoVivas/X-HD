within VCLib.Media.Refrigerants.R290_new;
package R290_new_IIR_P05_30_T263_343_Formula "Refrigerant model for R290 using a hybrid approach with explicit formulas
  developed by Sangi et al."
  constant Modelica.Media.Interfaces.PartialTwoPhaseMedium.FluidConstants[1]
    refrigerantConstants(
     each chemicalFormula = "C3H8",
     each structureFormula = "C3H8",
     each casRegistryNumber = "74-98-6",
     each iupacName = "Propane",
     each molarMass = 0.04409562,
     each criticalTemperature = 369.89,
     each criticalPressure = 4.2512e6,
     each criticalMolarVolume = 1/(5e3),
     each normalBoilingPoint = 231.036,
     each triplePointTemperature = 85.525,
     each meltingPoint = 85.45,
     each acentricFactor = 0.153,
     each triplePointPressure = 0.00017,
     each dipoleMoment = 0.1,
     each hasCriticalData=true) "Thermodynamic constants for Propane";

  extends
    VCLib.Media.Refrigerants.Interfaces.PartialHybridTwoPhaseMediumFormula(
    mediumName="Propane",
    substanceNames={"Propane"},
    singleState=false,
    SpecificEnthalpy(
      start=2.056719230221021e05,
      nominal=2.057e5,
      min=105.1241e3,
      max=991.8072e3),
    Density(
      start=300,
      nominal=529,
      min=1.1249,
      max=586.0756),
    AbsolutePressure(
      start=4.744575428061412e5,
      nominal=5e5,
      min=1e5,
      max=70e5),
    Temperature(
      start=273.15,
      nominal=333.15,
      min=233.15,
      max=473.15),
    smoothModel=true,
    onePhase=false,
    ThermoStates=Choices.IndependentVariables.phX,
    fluidConstants=refrigerantConstants);

  redeclare record SmoothTransition
    "Record that contains ranges to calculate a smooth transition between
    different regions"
      SpecificEnthalpy T_ph = 2.5;
      SpecificEntropy T_ps = 2.5;
      AbsolutePressure d_pT = 2.5;
      SpecificEnthalpy d_ph = 2.5;
      Real d_ps(unit="J/(Pa.K.kg)") =  25/(30e5-0.5e5);
      Real h_ps(unit="J/(Pa.K.kg)") = 50/(30e5-0.5e5);
  end SmoothTransition;

  redeclare function extends f_Idg
    "Dimensionless Helmholtz energy (Ideal gas contribution alpha_0)"
  algorithm
    f_Idg := log(delta) + (3) * log(tau) + (-4.970583) +
      (4.29352) * tau + (3.043) * log(1-exp(-(1.062478)*tau)) + (5.874) *
      log(1-exp(-(3.344237)*tau)) + (9.337) * log(1-exp(-(5.363757)*tau)) +
      (7.922) * log(1-exp(-(11.762957)*tau));
  end f_Idg;

  redeclare function extends f_Res
    "Dimensionless Helmholtz energy (Residual part alpha_r)"
  algorithm
    f_Res := (0.042910051) * delta^(4) * tau^(1) + (1.7313671) * delta^(1) *
      tau^(0.33) + (-2.4516524) * delta^(1) * tau^(0.8) + (0.34157466) *
      delta^(2) * tau^(0.43) + (-0.46047898) * delta^(2) * tau^(0.9) +
      (-0.66847295) * delta^(1) * tau^(2.46) * exp(-delta^(1)) + (0.20889705)
      * delta^(3) * tau^(2.09) * exp(-delta^(1)) + (0.19421381) * delta^(6) *
      tau^(0.88) * exp(-delta^(1)) + (-0.22917851) * delta^(6) * tau^(1.09) *
      exp(-delta^(1)) + (-0.60405866) * delta^(2) * tau^(3.25) *
      exp(-delta^(2)) + (0.066680654) * delta^(3) * tau^(4.62) *
      exp(-delta^(2)) + (0.017534618) * delta^(1) * tau^(0.76) *
      exp(-(0.963) * (delta - (1.283))^2 - (2.33) * (tau - (0.684))^2) +
      (0.33874242) * delta^(1) * tau^(2.5) * exp(-(1.977) * (delta -
      (0.6936))^2 - (3.47) * (tau - (0.829))^2) + (0.22228777) * delta^(1) *
      tau^(2.75) * exp(-(1.917) * (delta - (0.788))^2 - (3.15) * (tau -
      (1.419))^2) + (-0.23219062) * delta^(2) * tau^(3.05) * exp(-(2.307) *
      (delta - (0.473))^2 - (3.19) * (tau - (0.817))^2) + (-0.09220694) *
      delta^(2) * tau^(2.55) * exp(-(2.546) * (delta - (0.8577))^2 - (0.92) *
      (tau - (1.5))^2) + (-0.47575718) * delta^(4) * tau^(8.4) * exp(-(3.28) *
      (delta - (0.271))^2 - (18.8) * (tau - (1.426))^2) + (-0.017486824) *
      delta^(1) * tau^(6.75) * exp(-(14.6) * (delta - (0.948))^2 - (547.8) *
      (tau - (1.093))^2);
  end f_Res;

  redeclare function extends t_fIdg_t
    "Short form for tau*(dalpha_0/dtau)_delta=const"
  algorithm
    t_fIdg_t := (3) + (4.29352)* tau +
    tau*(3.043)*(1.062478)/(exp((1.062478)*tau)-1) + tau*(5.874)*
    (3.344237)/(exp((3.344237)*tau)-1) + tau*(9.337)*(5.363757)/
    (exp((5.363757)*tau)-1) + tau*(7.922)*(11.762957)/(exp((11.762957)*
    tau)-1);
  end t_fIdg_t;

  redeclare function extends tt_fIdg_tt
    "Short form for tau*tau*(ddalpha_0/(dtau*dtau))_delta=const"
  algorithm
    tt_fIdg_tt := -(3)
    - tau^2*(3.043)*(1.062478)^2*exp((1.062478)*tau)/(exp((1.062478)*tau)-1)^2
    - tau^2*(5.874)*(3.344237)^2*exp((3.344237)*tau)/(exp((3.344237)*tau)-1)^2
    - tau^2*(9.337)*(5.363757)^2*exp((5.363757)*tau)/(exp((5.363757)*tau)-1)^2
    - tau^2*(7.922)*(11.762957)^2*exp((11.762957)*tau)/(exp((11.762957)*tau)-1)^2;
  end tt_fIdg_tt;

  redeclare function extends t_fRes_t
    "Short form for tau*(dalpha_r/dtau)_delta=const"
  algorithm
    t_fRes_t := (0.042910051)*(1)*delta^(4)*tau^(1) + (1.7313671)*
      (0.33)*delta^(1)*tau^(0.33) + (-2.4516524)*(0.8)*delta^(1)*tau^(0.8) +
      (0.34157466)*(0.43)*delta^(2)*tau^(0.43) + (-0.46047898)*(0.9)*
      delta^(2)*tau^(0.9) + (-0.66847295)*(2.46)*delta^(1)*tau^(2.46)*
      exp(-delta^(1)) + (0.20889705)*(2.09)*delta^(3)*tau^(2.09)*
      exp(-delta^(1)) + (0.19421381)*(0.88)*delta^(6)*tau^(0.88)*
      exp(-delta^(1)) + (-0.22917851)*(1.09)*delta^(6)*tau^(1.09)*
      exp(-delta^(1)) + (-0.60405866)*(3.25)*delta^(2)*tau^(3.25)*
      exp(-delta^(2)) + (0.066680654)*(4.62)*delta^(3)*tau^(4.62)*
      exp(-delta^(2)) + (0.017534618)*delta^(1)*tau^(0.76)*exp(-(0.963)*
      (delta-(1.283))^2 - (2.33)*(tau-(0.684))^2)*((0.76) - 2*(2.33)*tau*
      (tau-(0.684))) + (0.33874242)*delta^(1)*tau^(2.5)*exp(-(1.977)*
      (delta-(0.6936))^2 - (3.47)*(tau-(0.829))^2)*((2.5) - 2*(3.47)*tau*
      (tau-(0.829))) + (0.22228777)*delta^(1)*tau^(2.75)*exp(-(1.917)*
      (delta-(0.788))^2 - (3.15)*(tau-(1.419))^2)*((2.75) - 2*(3.15)*tau*
      (tau-(1.419))) + (-0.23219062)*delta^(2)*tau^(3.05)*exp(-(2.307)*
      (delta-(0.473))^2 - (3.19)*(tau-(0.817))^2)*((3.05) - 2*(3.19)*tau*
      (tau-(0.817))) + (-0.09220694)*delta^(2)*tau^(2.55)*exp(-(2.546)*
      (delta-(0.8577))^2 - (0.92)*(tau-(1.5))^2)*((2.55) - 2*(0.92)*tau*
      (tau-(1.5))) + (-0.47575718)*delta^(4)*tau^(8.4)*exp(-(3.28)*
      (delta-(0.271))^2 - (18.8)*(tau-(1.426))^2)*((8.4) - 2*(18.8)*tau*
      (tau-(1.426))) + (-0.017486824)*delta^(1)*tau^(6.75)*exp(-(14.6)*
      (delta-(0.948))^2 - (547.8)*(tau-(1.093))^2)*((6.75) - 2*(547.8)*
      tau*(tau-(1.093)));
  end t_fRes_t;

  redeclare function extends tt_fRes_tt
    "Short form for tau*tau*(ddalpha_r/(dtau*dtau))_delta=const"
  algorithm
    tt_fRes_tt := (0.042910051)*(1)*((1)-1)*delta^(4)*tau^(1) +
      (1.7313671)*(0.33)*((0.33)-1)*delta^(1)*tau^(0.33) + (-2.4516524)*
      (0.8)*((0.8)-1)*delta^(1)*tau^(0.8) + (0.34157466)*(0.43)*((0.43)-1)*
      delta^(2)*tau^(0.43) + (-0.46047898)*(0.9)*((0.9)-1)*delta^(2)*
      tau^(0.9) + (-0.66847295)*(2.46)*((2.46)-1)*delta^(1)*tau^(2.46)*
      exp(-delta^(1)) + (0.20889705)*(2.09)*((2.09)-1)*delta^(3)*tau^(2.09)*
      exp(-delta^(1)) + (0.19421381)*(0.88)*((0.88)-1)*delta^(6)*tau^(0.88)*
      exp(-delta^(1)) + (-0.22917851)*(1.09)*((1.09)-1)*delta^(6)*tau^(1.09)*
      exp(-delta^(1)) + (-0.60405866)*(3.25)*((3.25)-1)*delta^(2)*tau^(3.25)*
      exp(-delta^(2)) + (0.066680654)*(4.62)*((4.62)-1)*delta^(3)*tau^(4.62)*
      exp(-delta^(2)) + (0.017534618)*delta^(1)*tau^(0.76)*exp(-(0.963)*
      (delta-(1.283))^2 - (2.33)*(tau-(0.684))^2)*(((0.76) - 2*(2.33)*tau*
      (tau-(0.684)))^2 -(0.76) - 2*(2.33)*tau^2) + (0.33874242)*delta^(1)*
      tau^(2.5)*exp(-(1.977)*(delta-(0.6936))^2 - (3.47)*(tau-(0.829))^2)*
      (((2.5) - 2*(3.47)*tau*(tau-(0.829)))^2 -(2.5) - 2*(3.47)*tau^2) +
      (0.22228777)*delta^(1)*tau^(2.75)*exp(-(1.917)*(delta-(0.788))^2 -
      (3.15)*(tau-(1.419))^2)*(((2.75) - 2*(3.15)*tau*(tau-(1.419)))^2 -
      (2.75) - 2*(3.15)*tau^2) + (-0.23219062)*delta^(2)*tau^(3.05)*
      exp(-(2.307)*(delta-(0.473))^2 - (3.19)*(tau-(0.817))^2)*(((3.05) - 2*
      (3.19)*tau*(tau-(0.817)))^2 -(3.05) - 2*(3.19)*tau^2) + (-0.09220694)*
      delta^(2)*tau^(2.55)*exp(-(2.546)*(delta-(0.8577))^2 - (0.92)*
      (tau-(1.5))^2)*(((2.55) - 2*(0.92)*tau*(tau-(1.5)))^2 -(2.55) - 2*
      (0.92)*tau^2) + (-0.47575718)*delta^(4)*tau^(8.4)*exp(-(3.28)*
      (delta-(0.271))^2 - (18.8)*(tau-(1.426))^2)*(((8.4) - 2*(18.8)*
      tau*(tau-(1.426)))^2 -(8.4) - 2*(18.8)*tau^2) + (-0.017486824)*
      delta^(1)*tau^(6.75)*exp(-(14.6)*(delta-(0.948))^2 - (547.8)*
      (tau-(1.093))^2)*(((6.75) - 2*(547.8)*tau*(tau-(1.093)))^2 -(6.75) - 2*
      (547.8)*tau^2);
  end tt_fRes_tt;

  redeclare function extends d_fRes_d
    "Short form for delta*(dalpha_r/(ddelta))_tau=const"
  algorithm
    d_fRes_d := (0.042910051)*(4)*delta^(4)*tau^(1) +
      (1.7313671)*(1)*delta^(1)*tau^(0.33) + (-2.4516524)*(1)*delta^(1)*
      tau^(0.8) + (0.34157466)*(2)*delta^(2)*tau^(0.43) + (-0.46047898)*
      (2)*delta^(2)*tau^(0.9) + (-0.66847295)*delta^(1)*tau^(2.46)*
      ((1)-(1)*delta^(1))*exp(-delta^(1)) + (0.20889705)*delta^(3)*
      tau^(2.09)*((3)-(1)*delta^(1))*exp(-delta^(1)) + (0.19421381)*
      delta^(6)*tau^(0.88)*((6)-(1)*delta^(1))*exp(-delta^(1)) +
      (-0.22917851)*delta^(6)*tau^(1.09)*((6)-(1)*delta^(1))*exp(-delta^(1))
      + (-0.60405866)*delta^(2)*tau^(3.25)*((2)-(2)*delta^(2))*
      exp(-delta^(2)) + (0.066680654)*delta^(3)*tau^(4.62)*((3)-(2)*
      delta^(2))*exp(-delta^(2)) + (0.017534618)*delta^(1)*tau^(0.76)*
      exp(-(0.963)*(delta-(1.283))^2 - (2.33)*(tau-(0.684))^2)*((1) - 2*
      (0.963)*delta*(delta-(1.283))) + (0.33874242)*delta^(1)*tau^(2.5)*
      exp(-(1.977)*(delta-(0.6936))^2 - (3.47)*(tau-(0.829))^2)*((1) - 2*
      (1.977)*delta*(delta-(0.6936))) + (0.22228777)*delta^(1)*tau^(2.75)*
      exp(-(1.917)*(delta-(0.788))^2 - (3.15)*(tau-(1.419))^2)*((1) - 2*
      (1.917)*delta*(delta-(0.788))) + (-0.23219062)*delta^(2)*tau^(3.05)*
      exp(-(2.307)*(delta-(0.473))^2 - (3.19)*(tau-(0.817))^2)*((2) - 2*
      (2.307)*delta*(delta-(0.473))) + (-0.09220694)*delta^(2)*tau^(2.55)*
      exp(-(2.546)*(delta-(0.8577))^2 - (0.92)*(tau-(1.5))^2)*((2) - 2*
      (2.546)*delta*(delta-(0.8577))) + (-0.47575718)*delta^(4)*tau^(8.4)*
      exp(-(3.28)*(delta-(0.271))^2 - (18.8)*(tau-(1.426))^2)*((4) - 2*
      (3.28)*delta*(delta-(0.271))) + (-0.017486824)*delta^(1)*tau^(6.75)*
      exp(-(14.6)*(delta-(0.948))^2 - (547.8)*(tau-(1.093))^2)*((1) - 2*
      (14.6)*delta*(delta-(0.948)));
  end d_fRes_d;

  redeclare function extends dd_fRes_dd
    "Short form for delta*delta(ddalpha_r/(ddelta*delta))_tau=const"
  algorithm
    dd_fRes_dd := (0.042910051)*(4)*((4)-1)*delta^(4)*
      tau^(1) + (1.7313671)*(1)*((1)-1)*delta^(1)*tau^(0.33) + (-2.4516524)*
      (1)*((1)-1)*delta^(1)*tau^(0.8) + (0.34157466)*(2)*((2)-1)*delta^(2)*
      tau^(0.43) + (-0.46047898)*(2)*((2)-1)*delta^(2)*tau^(0.9) +
      (-0.66847295)*delta^(1)*tau^(2.46)*(((1)-(1)*delta^(1))*((1)-1-(1)*
      delta^(1))-(1)^2*delta^(1))*exp(-delta^(1)) + (0.20889705)*delta^(3)*
      tau^(2.09)*(((3)-(1)*delta^(1))*((3)-1-(1)*delta^(1))-(1)^2*delta^(1))*
      exp(-delta^(1)) + (0.19421381)*delta^(6)*tau^(0.88)*(((6)-(1)*
      delta^(1))*((6)-1-(1)*delta^(1))-(1)^2*delta^(1))*exp(-delta^(1)) +
      (-0.22917851)*delta^(6)*tau^(1.09)*(((6)-(1)*delta^(1))*((6)-1-(1)*
      delta^(1))-(1)^2*delta^(1))*exp(-delta^(1)) + (-0.60405866)*delta^(2)*
      tau^(3.25)*(((2)-(2)*delta^(2))*((2)-1-(2)*delta^(2))-(2)^2*delta^(2))*
      exp(-delta^(2)) + (0.066680654)*delta^(3)*tau^(4.62)*(((3)-(2)*
      delta^(2))*((3)-1-(2)*delta^(2))-(2)^2*delta^(2))*exp(-delta^(2)) +
      (0.017534618)*delta^(1)*tau^(0.76)*exp(-(0.963)*(delta-(1.283))^2 -
      (2.33)*(tau-(0.684))^2)*(((1) - 2*(0.963)*delta*(delta-(1.283)))^2 -
      (1) - 2*(0.963)*delta^2) + (0.33874242)*delta^(1)*tau^(2.5)*
      exp(-(1.977)*(delta-(0.6936))^2 - (3.47)*(tau-(0.829))^2)*(((1) - 2*
      (1.977)*delta*(delta-(0.6936)))^2 - (1) - 2*(1.977)*delta^2) +
      (0.22228777)*delta^(1)*tau^(2.75)*exp(-(1.917)*(delta-(0.788))^2 -
      (3.15)*(tau-(1.419))^2)*(((1) - 2*(1.917)*delta*(delta-(0.788)))^2 -
      (1) - 2*(1.917)*delta^2) + (-0.23219062)*delta^(2)*tau^(3.05)*
      exp(-(2.307)*(delta-(0.473))^2 - (3.19)*(tau-(0.817))^2)*(((2) - 2*
      (2.307)*delta*(delta-(0.473)))^2 - (2) - 2*(2.307)*delta^2) +
      (-0.09220694)*delta^(2)*tau^(2.55)*exp(-(2.546)*(delta-(0.8577))^2 -
      (0.92)*(tau-(1.5))^2)*(((2) - 2*(2.546)*delta*(delta-(0.8577)))^2 -
      (2) - 2*(2.546)*delta^2) + (-0.47575718)*delta^(4)*tau^(8.4)*
      exp(-(3.28)*(delta-(0.271))^2 - (18.8)*(tau-(1.426))^2)*(((4) - 2*
      (3.28)*delta*(delta-(0.271)))^2 - (4) - 2*(3.28)*delta^2) +
      (-0.017486824)*delta^(1)*tau^(6.75)*exp(-(14.6)*(delta-(0.948))^2 -
      (547.8)*(tau-(1.093))^2)*(((1) - 2*(14.6)*delta*(delta-(0.948)))^2 -
      (1) - 2*(14.6)*delta^2);
  end dd_fRes_dd;

  redeclare function extends td_fRes_td
    "Short form for tau*delta*(ddalpha_r/(dtau*ddelta))"
  algorithm
    td_fRes_td := (0.042910051)*(4)*(1)*delta^(4)*
      tau^(1) + (1.7313671)*(1)*(0.33)*delta^(1)*tau^(0.33) + (-2.4516524)*
      (1)*(0.8)*delta^(1)*tau^(0.8) + (0.34157466)*(2)*(0.43)*delta^(2)*
      tau^(0.43) + (-0.46047898)*(2)*(0.9)*delta^(2)*tau^(0.9) +
      (-0.66847295)*(2.46)*delta^(1)*tau^(2.46)*((1)-(1)*delta^(1))*
      exp(-delta^(1)) + (0.20889705)*(2.09)*delta^(3)*tau^(2.09)*((3)-(1)*
      delta^(1))*exp(-delta^(1)) + (0.19421381)*(0.88)*delta^(6)*tau^(0.88)*
      ((6)-(1)*delta^(1))*exp(-delta^(1)) + (-0.22917851)*(1.09)*delta^(6)*
      tau^(1.09)*((6)-(1)*delta^(1))*exp(-delta^(1)) + (-0.60405866)*(3.25)*
      delta^(2)*tau^(3.25)*((2)-(2)*delta^(2))*exp(-delta^(2)) +
      (0.066680654)*(4.62)*delta^(3)*tau^(4.62)*((3)-(2)*delta^(2))*
      exp(-delta^(2)) + (0.017534618)*delta^(1)*tau^(0.76)*exp(-(0.963)*
      (delta-(1.283))^2 - (2.33)*(tau-(0.684))^2)*((0.76) - 2*(2.33)*tau*
      (tau-(0.684)))*((1) - 2*(0.963)*delta*(delta-(1.283))) + (0.33874242)*
      delta^(1)*tau^(2.5)*exp(-(1.977)*(delta-(0.6936))^2 - (3.47)*
      (tau-(0.829))^2)*((2.5) - 2*(3.47)*tau*(tau-(0.829)))*((1) - 2*(1.977)*
      delta*(delta-(0.6936))) + (0.22228777)*delta^(1)*tau^(2.75)*
      exp(-(1.917)*(delta-(0.788))^2 - (3.15)*(tau-(1.419))^2)*((2.75) - 2*
      (3.15)*tau*(tau-(1.419)))*((1) - 2*(1.917)*delta*(delta-(0.788))) +
      (-0.23219062)*delta^(2)*tau^(3.05)*exp(-(2.307)*(delta-(0.473))^2 -
      (3.19)*(tau-(0.817))^2)*((3.05) - 2*(3.19)*tau*(tau-(0.817)))*((2) -
      2*(2.307)*delta*(delta-(0.473))) + (-0.09220694)*delta^(2)*tau^(2.55)*
      exp(-(2.546)*(delta-(0.8577))^2 - (0.92)*(tau-(1.5))^2)*((2.55) - 2*
      (0.92)*tau*(tau-(1.5)))*((2) - 2*(2.546)*delta*(delta-(0.8577))) +
      (-0.47575718)*delta^(4)*tau^(8.4)*exp(-(3.28)*(delta-(0.271))^2 -
      (18.8)*(tau-(1.426))^2)*((8.4) - 2*(18.8)*tau*(tau-(1.426)))*((4) - 2*
      (3.28)*delta*(delta-(0.271))) + (-0.017486824)*delta^(1)*tau^(6.75)*
      exp(-(14.6)*(delta-(0.948))^2 - (547.8)*(tau-(1.093))^2)*((6.75) - 2*
      (547.8)*tau*(tau-(1.093)))*((1) - 2*(14.6)*delta*(delta-(0.948)));
  end td_fRes_td;

  redeclare function extends ttt_fIdg_ttt
    "Short form for tau*tau*tau*(dddalpha_0/(dtau*dtau*dtau))_delta=const"
  algorithm
    ttt_fIdg_ttt := 2*(3)*(1) + (-4.970583)*(0)*((0)-1)*((0)-2) *
      tau^(0) + (4.29352)*(1)*((1)-1)*((1)-2) *tau^(1) + tau^3*(3.043)*
      (1.062478)^3*exp((1.062478)*tau)*(exp((1.062478)*tau)+1)/
      (exp((1.062478)*tau)-1)^3 + tau^3*(5.874)*(3.344237)^3*exp((3.344237)*
      tau)*(exp((3.344237)*tau)+1)/(exp((3.344237)*tau)-1)^3 + tau^3*(9.337)*
      (5.363757)^3*exp((5.363757)*tau)*(exp((5.363757)*tau)+1)/
      (exp((5.363757)*tau)-1)^3 + tau^3*(7.922)*(11.762957)^3*exp((11.762957)*
      tau)*(exp((11.762957)*tau)+1)/(exp((11.762957)*tau)-1)^3;
  end ttt_fIdg_ttt;

  redeclare function extends ttt_fRes_ttt
    "Short form for tau*tau*tau*(dddalpha_r/(dtau*dtau*dtau))_delta=const"
  algorithm
    ttt_fRes_ttt := (0.042910051)*(1)*((1)-1)*((1)-2)*delta^(4)*
      tau^(1) + (1.7313671)*(0.33)*((0.33)-1)*((0.33)-2)*delta^(1)*
      tau^(0.33) + (-2.4516524)*(0.8)*((0.8)-1)*((0.8)-2)*delta^(1)*
      tau^(0.8) + (0.34157466)*(0.43)*((0.43)-1)*((0.43)-2)*delta^(2)*
      tau^(0.43) + (-0.46047898)*(0.9)*((0.9)-1)*((0.9)-2)*delta^(2)*
      tau^(0.9) + (-0.66847295)*(2.46)*((2.46)-1)*((2.46)-2)*delta^(1)*
      tau^(2.46)*exp(-delta^(1)) + (0.20889705)*(2.09)*((2.09)-1)*((2.09)-2)*
      delta^(3)*tau^(2.09)*exp(-delta^(1)) + (0.19421381)*(0.88)*((0.88)-1)*
      ((0.88)-2)*delta^(6)*tau^(0.88)*exp(-delta^(1)) + (-0.22917851)*
      (1.09)*((1.09)-1)*((1.09)-2)*delta^(6)*tau^(1.09)*exp(-delta^(1)) +
      (-0.60405866)*(3.25)*((3.25)-1)*((3.25)-2)*delta^(2)*tau^(3.25)*
      exp(-delta^(2)) + (0.066680654)*(4.62)*((4.62)-1)*((4.62)-2)*
      delta^(3)*tau^(4.62)*exp(-delta^(2)) - (0.017534618)*delta^(1)*
      tau^(0.76)*exp(-(0.963)*(delta-(1.283))^2 - (2.33)*(tau-(0.684))^2)*
      (8*(2.33)^3*tau^6-24*(2.33)^3*(0.684)*tau^5+12*(2.33)^2*(2*(2.33)*
      (0.684)^2-(0.76)-1)*tau^4-4*(2.33)^2*(0.684)*(2*(2.33)*(0.684)^2-6*
      (0.76)-3)*tau^3-6*(0.76)*(2.33)*(2*(2.33)*(0.684)^2-(0.76))*tau^2-6*
      ((0.76)-1)*(0.76)*(2.33)*(0.684)*tau-(0.76)^3+3*(0.76)^2-2*(0.76)) -
      (0.33874242)*delta^(1)*tau^(2.5)*exp(-(1.977)*(delta-(0.6936))^2 -
      (3.47)*(tau-(0.829))^2)*(8*(3.47)^3*tau^6-24*(3.47)^3*(0.829)*tau^5+
      12*(3.47)^2*(2*(3.47)*(0.829)^2-(2.5)-1)*tau^4-4*(3.47)^2*(0.829)*(2*
      (3.47)*(0.829)^2-6*(2.5)-3)*tau^3-6*(2.5)*(3.47)*(2*(3.47)*(0.829)^2-
      (2.5))*tau^2-6*((2.5)-1)*(2.5)*(3.47)*(0.829)*tau-(2.5)^3+3*(2.5)^2-2*
      (2.5)) - (0.22228777)*delta^(1)*tau^(2.75)*exp(-(1.917)*(delta-
      (0.788))^2 - (3.15)*(tau-(1.419))^2)*(8*(3.15)^3*tau^6-24*(3.15)^3*
      (1.419)*tau^5+12*(3.15)^2*(2*(3.15)*(1.419)^2-(2.75)-1)*tau^4-4*
      (3.15)^2*(1.419)*(2*(3.15)*(1.419)^2-6*(2.75)-3)*tau^3-6*(2.75)*
      (3.15)*(2*(3.15)*(1.419)^2-(2.75))*tau^2-6*((2.75)-1)*(2.75)*(3.15)*
      (1.419)*tau-(2.75)^3+3*(2.75)^2-2*(2.75)) - (-0.23219062)*delta^(2)*
      tau^(3.05)*exp(-(2.307)*(delta-(0.473))^2 - (3.19)*(tau-(0.817))^2)*
      (8*(3.19)^3*tau^6-24*(3.19)^3*(0.817)*tau^5+12*(3.19)^2*(2*(3.19)*
      (0.817)^2-(3.05)-1)*tau^4-4*(3.19)^2*(0.817)*(2*(3.19)*(0.817)^2-6*
      (3.05)-3)*tau^3-6*(3.05)*(3.19)*(2*(3.19)*(0.817)^2-(3.05))*tau^2-6*
      ((3.05)-1)*(3.05)*(3.19)*(0.817)*tau-(3.05)^3+3*(3.05)^2-2*(3.05)) -
      (-0.09220694)*delta^(2)*tau^(2.55)*exp(-(2.546)*(delta-(0.8577))^2 -
      (0.92)*(tau-(1.5))^2)*(8*(0.92)^3*tau^6-24*(0.92)^3*(1.5)*tau^5+12*
      (0.92)^2*(2*(0.92)*(1.5)^2-(2.55)-1)*tau^4-4*(0.92)^2*(1.5)*(2*(0.92)*
      (1.5)^2-6*(2.55)-3)*tau^3-6*(2.55)*(0.92)*(2*(0.92)*(1.5)^2-(2.55))*
      tau^2-6*((2.55)-1)*(2.55)*(0.92)*(1.5)*tau-(2.55)^3+3*(2.55)^2-2*
      (2.55)) - (-0.47575718)*delta^(4)*tau^(8.4)*exp(-(3.28)*(delta-
      (0.271))^2 - (18.8)*(tau-(1.426))^2)*(8*(18.8)^3*tau^6-24*(18.8)^3*
      (1.426)*tau^5+12*(18.8)^2*(2*(18.8)*(1.426)^2-(8.4)-1)*tau^4-4*
      (18.8)^2*(1.426)*(2*(18.8)*(1.426)^2-6*(8.4)-3)*tau^3-6*(8.4)*(18.8)*
      (2*(18.8)*(1.426)^2-(8.4))*tau^2-6*((8.4)-1)*(8.4)*(18.8)*(1.426)*
      tau-(8.4)^3+3*(8.4)^2-2*(8.4)) - (-0.017486824)*delta^(1)*tau^(6.75)*
      exp(-(14.6)*(delta-(0.948))^2 - (547.8)*(tau-(1.093))^2)*(8*(547.8)^3*
      tau^6-24*(547.8)^3*(1.093)*tau^5+12*(547.8)^2*(2*(547.8)*(1.093)^2-
      (6.75)-1)*tau^4-4*(547.8)^2*(1.093)*(2*(547.8)*(1.093)^2-6*(6.75)-3)*
      tau^3-6*(6.75)*(547.8)*(2*(547.8)*(1.093)^2-(6.75))*tau^2-6*((6.75)-1)*
      (6.75)*(547.8)*(1.093)*tau-(6.75)^3+3*(6.75)^2-2*(6.75));
  end ttt_fRes_ttt;

  redeclare function extends ddd_fRes_ddd
    "Short form for delta*delta*delta*
    (dddalpha_r/(ddelta*ddelta*ddelta))_tau=const"
  algorithm
    ddd_fRes_ddd := (0.042910051)*(4)*((4)-1)*((4)-2)*
      delta^(4)*tau^(1) + (1.7313671)*(1)*((1)-1)*((1)-2)*delta^(1)*
      tau^(0.33) + (-2.4516524)*(1)*((1)-1)*((1)-2)*delta^(1)*tau^(0.8) +
      (0.34157466)*(2)*((2)-1)*((2)-2)*delta^(2)*tau^(0.43) + (-0.46047898)*
      (2)*((2)-1)*((2)-2)*delta^(2)*tau^(0.9) - (-0.66847295)*delta^(1)*
      tau^(2.46)*exp(-delta^(1))*((1)*delta^(1)*((1)*(delta^(1)*((1)*
      (delta^(1)-3)-3*(1)+3)+(1)+3*(1)-3)+3*(1)^2-6*(1)+2)-((1)-2)*((1)-1)*
      (1)) - (0.20889705)*delta^(3)*tau^(2.09)*exp(-delta^(1))*((1)*
      delta^(1)*((1)*(delta^(1)*((1)*(delta^(1)-3)-3*(3)+3)+(1)+3*(3)-3)+3*
      (3)^2-6*(3)+2)-((3)-2)*((3)-1)*(3)) - (0.19421381)*delta^(6)*
      tau^(0.88)*exp(-delta^(1))*((1)*delta^(1)*((1)*(delta^(1)*((1)*
      (delta^(1)-3)-3*(6)+3)+(1)+3*(6)-3)+3*(6)^2-6*(6)+2)-((6)-2)*((6)-1)*
      (6)) - (-0.22917851)*delta^(6)*tau^(1.09)*exp(-delta^(1))*((1)*
      delta^(1)*((1)*(delta^(1)*((1)*(delta^(1)-3)-3*(6)+3)+(1)+3*(6)-3)+3*
      (6)^2-6*(6)+2)-((6)-2)*((6)-1)*(6)) - (-0.60405866)*delta^(2)*
      tau^(3.25)*exp(-delta^(2))*((2)*delta^(2)*((2)*(delta^(2)*((2)*
      (delta^(2)-3)-3*(2)+3)+(2)+3*(2)-3)+3*(2)^2-6*(2)+2)-((2)-2)*((2)-1)*
      (2)) - (0.066680654)*delta^(3)*tau^(4.62)*exp(-delta^(2))*((2)*
      delta^(2)*((2)*(delta^(2)*((2)*(delta^(2)-3)-3*(3)+3)+(2)+3*(3)-3)+3*
      (3)^2-6*(3)+2)-((3)-2)*((3)-1)*(3)) - (0.017534618)*delta^(1)*
      tau^(0.76)*exp(-(0.963)*(delta-(1.283))^2 - (2.33)*(tau-(0.684))^2)*
      (8*(0.963)^3*delta^6-24*(0.963)^3*(1.283)*delta^5+12*(0.963)^2*(2*
      (0.963)*(1.283)^2-(1)-1)*delta^4-4*(0.963)^2*(1.283)*(2*(0.963)*
      (1.283)^2-6*(1)-3)*delta^3-6*(1)*(0.963)*(2*(0.963)*(1.283)^2-(1))*
      delta^2-6*((1)-1)*(1)*(0.963)*(1.283)*delta-(1)^3+3*(1)^2-2*(1)) -
      (0.33874242)*delta^(1)*tau^(2.5)*exp(-(1.977)*(delta-(0.6936))^2 -
      (3.47)*(tau-(0.829))^2)*(8*(1.977)^3*delta^6-24*(1.977)^3*(0.6936)*
      delta^5+12*(1.977)^2*(2*(1.977)*(0.6936)^2-(1)-1)*delta^4-4*(1.977)^2*
      (0.6936)*(2*(1.977)*(0.6936)^2-6*(1)-3)*delta^3-6*(1)*(1.977)*(2*
      (1.977)*(0.6936)^2-(1))*delta^2-6*((1)-1)*(1)*(1.977)*(0.6936)*delta-
      (1)^3+3*(1)^2-2*(1)) - (0.22228777)*delta^(1)*tau^(2.75)*exp(-(1.917)*
      (delta-(0.788))^2 - (3.15)*(tau-(1.419))^2)*(8*(1.917)^3*delta^6-24*
      (1.917)^3*(0.788)*delta^5+12*(1.917)^2*(2*(1.917)*(0.788)^2-(1)-1)*
      delta^4-4*(1.917)^2*(0.788)*(2*(1.917)*(0.788)^2-6*(1)-3)*delta^3-6*
      (1)*(1.917)*(2*(1.917)*(0.788)^2-(1))*delta^2-6*((1)-1)*(1)*(1.917)*
      (0.788)*delta-(1)^3+3*(1)^2-2*(1)) - (-0.23219062)*delta^(2)*tau^(3.05)*
      exp(-(2.307)*(delta-(0.473))^2 - (3.19)*(tau-(0.817))^2)*(8*(2.307)^3*
      delta^6-24*(2.307)^3*(0.473)*delta^5+12*(2.307)^2*(2*(2.307)*(0.473)^2-
      (2)-1)*delta^4-4*(2.307)^2*(0.473)*(2*(2.307)*(0.473)^2-6*(2)-3)*
      delta^3-6*(2)*(2.307)*(2*(2.307)*(0.473)^2-(2))*delta^2-6*((2)-1)*
      (2)*(2.307)*(0.473)*delta-(2)^3+3*(2)^2-2*(2)) - (-0.09220694)*
      delta^(2)*tau^(2.55)*exp(-(2.546)*(delta-(0.8577))^2 - (0.92)*
      (tau-(1.5))^2)*(8*(2.546)^3*delta^6-24*(2.546)^3*(0.8577)*delta^5+12*
      (2.546)^2*(2*(2.546)*(0.8577)^2-(2)-1)*delta^4-4*(2.546)^2*(0.8577)*(2*
      (2.546)*(0.8577)^2-6*(2)-3)*delta^3-6*(2)*(2.546)*(2*(2.546)*
      (0.8577)^2-(2))*delta^2-6*((2)-1)*(2)*(2.546)*(0.8577)*delta-(2)^3+3*
      (2)^2-2*(2)) - (-0.47575718)*delta^(4)*tau^(8.4)*exp(-(3.28)*
      (delta-(0.271))^2 - (18.8)*(tau-(1.426))^2)*(8*(3.28)^3*delta^6-24*
      (3.28)^3*(0.271)*delta^5+12*(3.28)^2*(2*(3.28)*(0.271)^2-(4)-1)*
      delta^4-4*(3.28)^2*(0.271)*(2*(3.28)*(0.271)^2-6*(4)-3)*delta^3-6*(4)*
      (3.28)*(2*(3.28)*(0.271)^2-(4))*delta^2-6*((4)-1)*(4)*(3.28)*(0.271)*
      delta-(4)^3+3*(4)^2-2*(4)) - (-0.017486824)*delta^(1)*tau^(6.75)*
      exp(-(14.6)*(delta-(0.948))^2 - (547.8)*(tau-(1.093))^2)*(8*(14.6)^3*
      delta^6-24*(14.6)^3*(0.948)*delta^5+12*(14.6)^2*(2*(14.6)*
      (0.948)^2-(1)-1)*delta^4-4*(14.6)^2*(0.948)*(2*(14.6)*(0.948)^2-6*
      (1)-3)*delta^3-6*(1)*(14.6)*(2*(14.6)*(0.948)^2-(1))*delta^2-6*
      ((1)-1)*(1)*(14.6)*(0.948)*delta-(1)^3+3*(1)^2-2*(1));
  end ddd_fRes_ddd;

  redeclare function extends tdd_fRes_tdd
    "Short form for tau*delta*delta*(dddalpha_r/(dtau*ddelta*ddelta))"
  algorithm
    tdd_fRes_tdd := (0.042910051)*(4)*(1)*(4-1)*
      delta^(4)*tau^(1) + (1.7313671)*(1)*(0.33)*(1-1)*delta^(1)*tau^(0.33) +
      (-2.4516524)*(1)*(0.8)*(1-1)*delta^(1)*tau^(0.8) + (0.34157466)*(2)*
      (0.43)*(2-1)*delta^(2)*tau^(0.43) + (-0.46047898)*(2)*(0.9)*(2-1)*
      delta^(2)*tau^(0.9) + (-0.66847295)*(2.46)*delta^(1)*tau^(2.46)*
      exp(-delta^(1))*((1)*delta^(1)*((1)*(delta^(1)-1)-2*(1)+1)+(1)*
      ((1)-1)) + (0.20889705)*(2.09)*delta^(3)*tau^(2.09)*exp(-delta^(1))*
      ((1)*delta^(1)*((1)*(delta^(1)-1)-2*(3)+1)+(3)*((3)-1)) + (0.19421381)*
      (0.88)*delta^(6)*tau^(0.88)*exp(-delta^(1))*((1)*delta^(1)*((1)*
      (delta^(1)-1)-2*(6)+1)+(6)*((6)-1)) + (-0.22917851)*(1.09)*delta^(6)*
      tau^(1.09)*exp(-delta^(1))*((1)*delta^(1)*((1)*(delta^(1)-1)-2*(6)+1)+
      (6)*((6)-1)) + (-0.60405866)*(3.25)*delta^(2)*tau^(3.25)*exp(-delta^(2))
      *((2)*delta^(2)*((2)*(delta^(2)-1)-2*(2)+1)+(2)*((2)-1)) +
      (0.066680654)*(4.62)*delta^(3)*tau^(4.62)*exp(-delta^(2))*((2)*
      delta^(2)*((2)*(delta^(2)-1)-2*(3)+1)+(3)*((3)-1)) + (0.017534618)*
      delta^(1)*tau^(0.76)*exp(-(0.963)*(delta - (1.283))^2 - (2.33)*
      (tau - (0.684))^2)*((0.76)-2*(2.33)*tau*(tau-(0.684)))*(((1)-2*(0.963)*
      delta*(delta-(1.283)))^2-(1)-2*(0.963)*delta^2) + (0.33874242)*
      delta^(1)*tau^(2.5)*exp(-(1.977)*(delta - (0.6936))^2 - (3.47)*
      (tau - (0.829))^2)*((2.5)-2*(3.47)*tau*(tau-(0.829)))*(((1)-2*(1.977)*
      delta*(delta-(0.6936)))^2-(1)-2*(1.977)*delta^2) + (0.22228777)*
      delta^(1)*tau^(2.75)*exp(-(1.917)*(delta - (0.788))^2 - (3.15)*
      (tau - (1.419))^2)*((2.75)-2*(3.15)*tau*(tau-(1.419)))*(((1)-2*
      (1.917)*delta*(delta-(0.788)))^2-(1)-2*(1.917)*delta^2) + (-0.23219062)*
      delta^(2)*tau^(3.05)*exp(-(2.307)*(delta - (0.473))^2 - (3.19)*
      (tau - (0.817))^2)*((3.05)-2*(3.19)*tau*(tau-(0.817)))*(((2)-2*(2.307)*
      delta*(delta-(0.473)))^2-(2)-2*(2.307)*delta^2) + (-0.09220694)*
      delta^(2)*tau^(2.55)*exp(-(2.546)*(delta - (0.8577))^2 - (0.92)*
      (tau - (1.5))^2)*((2.55)-2*(0.92)*tau*(tau-(1.5)))*(((2)-2*(2.546)*
      delta*(delta-(0.8577)))^2-(2)-2*(2.546)*delta^2) + (-0.47575718)*
      delta^(4)*tau^(8.4)*exp(-(3.28)*(delta - (0.271))^2 - (18.8)*
      (tau - (1.426))^2)*((8.4)-2*(18.8)*tau*(tau-(1.426)))*(((4)-2*
      (3.28)*delta*(delta-(0.271)))^2-(4)-2*(3.28)*delta^2) + (-0.017486824)*
      delta^(1)*tau^(6.75)*exp(-(14.6)*(delta - (0.948))^2 - (547.8)*
      (tau - (1.093))^2)*((6.75)-2*(547.8)*tau*(tau-(1.093)))*(((1)-2*(14.6)*
      delta*(delta-(0.948)))^2-(1)-2*(14.6)*delta^2);
  end tdd_fRes_tdd;

  redeclare function extends ttd_fRes_ttd
    "Short form for tau*tau*delta*(dddalpha_r/(dtau*dtau*ddelta))"
  algorithm
    ttd_fRes_ttd := (0.042910051)*(4)*(1)*(1-1)*
      delta^(4)*tau^(1) + (1.7313671)*(1)*(0.33)*(0.33-1)*delta^(1)*
      tau^(0.33) + (-2.4516524)*(1)*(0.8)*(0.8-1)*delta^(1)*tau^(0.8) +
      (0.34157466)*(2)*(0.43)*(0.43-1)*delta^(2)*tau^(0.43) + (-0.46047898)*
      (2)*(0.9)*(0.9-1)*delta^(2)*tau^(0.9) + (-0.66847295)*(2.46)*((2.46)-1)*
      delta^(1)*tau^(2.46)*exp(-delta^(1))*((1)-(1)*delta^(1)) + (0.20889705)*
      (2.09)*((2.09)-1)*delta^(3)*tau^(2.09)*exp(-delta^(1))*((3)-(1)*
      delta^(1)) + (0.19421381)*(0.88)*((0.88)-1)*delta^(6)*tau^(0.88)*
      exp(-delta^(1))*((6)-(1)*delta^(1)) + (-0.22917851)*(1.09)*((1.09)-1)*
      delta^(6)*tau^(1.09)*exp(-delta^(1))*((6)-(1)*delta^(1)) + (-0.60405866)*
      (3.25)*((3.25)-1)*delta^(2)*tau^(3.25)*exp(-delta^(2))*((2)-(2)*
      delta^(2)) + (0.066680654)*(4.62)*((4.62)-1)*delta^(3)*tau^(4.62)*
      exp(-delta^(2))*((3)-(2)*delta^(2)) + (0.017534618)*delta^(1)*
      tau^(0.76)*exp(-(0.963)*(delta - (1.283))^2 - (2.33)*(tau - (0.684))^2)*
      ((1)-2*(0.963)*delta*(delta-(1.283)))*(((0.76)-2*(2.33)*tau*
      (tau-(0.684)))^2-(0.76)-2*(2.33)*tau^2) + (0.33874242)*delta^(1)*
      tau^(2.5)*exp(-(1.977)*(delta - (0.6936))^2 - (3.47)*(tau - (0.829))^2)*
      ((1)-2*(1.977)*delta*(delta-(0.6936)))*(((2.5)-2*(3.47)*tau*
      (tau-(0.829)))^2-(2.5)-2*(3.47)*tau^2) + (0.22228777)*delta^(1)*
      tau^(2.75)*exp(-(1.917)*(delta - (0.788))^2 - (3.15)*(tau - (1.419))^2)*
      ((1)-2*(1.917)*delta*(delta-(0.788)))*(((2.75)-2*(3.15)*tau*
      (tau-(1.419)))^2-(2.75)-2*(3.15)*tau^2) + (-0.23219062)*delta^(2)*
      tau^(3.05)*exp(-(2.307)*(delta - (0.473))^2 - (3.19)*(tau - (0.817))^2)*
      ((2)-2*(2.307)*delta*(delta-(0.473)))*(((3.05)-2*(3.19)*tau*
      (tau-(0.817)))^2-(3.05)-2*(3.19)*tau^2) + (-0.09220694)*delta^(2)*
      tau^(2.55)*exp(-(2.546)*(delta - (0.8577))^2 - (0.92)*(tau - (1.5))^2)*
      ((2)-2*(2.546)*delta*(delta-(0.8577)))*(((2.55)-2*(0.92)*tau*
      (tau-(1.5)))^2-(2.55)-2*(0.92)*tau^2) + (-0.47575718)*delta^(4)*
      tau^(8.4)*exp(-(3.28)*(delta - (0.271))^2 - (18.8)*(tau - (1.426))^2)*
      ((4)-2*(3.28)*delta*(delta-(0.271)))*(((8.4)-2*(18.8)*tau*
      (tau-(1.426)))^2-(8.4)-2*(18.8)*tau^2) + (-0.017486824)*delta^(1)*
      tau^(6.75)*exp(-(14.6)*(delta - (0.948))^2 - (547.8)*
      (tau - (1.093))^2)*((1)-2*(14.6)*delta*(delta-(0.948)))*
      (((6.75)-2*(547.8)*tau*(tau-(1.093)))^2-(6.75)-2*(547.8)*tau^2);
  end ttd_fRes_ttd;

  redeclare function extends saturationPressure
    "Saturation pressure of refrigerant (Ancillary equation)"
    //Real OM = (1 - T/369.89); //Tcrit
  protected
    Real x = (T/369.89); //Tcrit

  algorithm
    if T>369.89 then
      p := 4251200;          //pcrit
    elseif T <= 85.525 then   //T_triple
      p := 0.00017;          //p_triple
    else
      p := 4251200 * (exp((1./x) .*
      ((75.321408974284).*(1-x).^(1.07222407534831) +
      (-81.0519041152623).*(1-x).^(1.06307154066207) +
      (18.0065546009563).*(1-x).^(19.7455632850335) +
      (7295.15298167272).*(1-x).^(25.730692124317) +
      (-2.15339222957172).*(1-x).^(3.44187720093662))));

    end if;
    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end saturationPressure;

  redeclare function extends saturationTemperature
    "Saturation temperature of refrigerant (Ancillary equation)"
  protected
    Real x;

  algorithm
    if p >= 4251200 then          //pcrit
      T := 369.89;                //Tcrit
    elseif p <= 0.00017 then      //ptripple
      T := 85.525;                //Ttripple
    else
    x :=(p - (1.410067058285438e+06)) ./ (1.172328606200022e+06);

    T := (3.015000000000000e+02) + (39.505189532515864) *
    ((0.327142413594078) + (0.918803545641917)*x^1 +
    (-0.28335991167756)*x^2 + (0.13130284978973)*x^3 +
    (-0.0279888056297166)*x^4 + (0.0428751451664073)*x^5 +
    (-0.261455679287493)*x^6 + (0.147372009698933)*x^7 +
    (0.473143725939544)*x^8 + (-0.450473884781917)*x^9 +
    (-0.445107795656954)*x^10 + (0.707911493631686)*x^11 +
    (-0.00033297886958425)*x^12 + (-0.445539845883485)*x^13 +
    (0.224992751087163)*x^14 + (0.0556376331286283)*x^15 +
    (-0.095281709871434)*x^16 + (0.0393888618833131)*x^17 +
    (-0.00747423192762247)*x^18 + (0.000562033868963072)*x^19);
    end if;

    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end saturationTemperature;

  redeclare function extends bubbleDensity
    "Boiling curve specific density of refrigerant (Ancillary equation)"
  protected
    Real x;

  algorithm
    x := (sat.Tsat / 369.89);

    if x >= 1 then      //test
      x := 0.999999999;
    end if;

    dl := (4.732866734679028e+02) * (exp((1./x) *
    ((-2.4141175234946)*(1-x)^(0.0647872522169903) +
    (98.0943087223411)*(1-x)^(22.4464132212873) +
    (-30.7401353296442)*(1-x)^(0.422364028929688) +
    (12.8111416646539)*(1-x)^(1.59683055514672) +
    (-135.372211203363)*(1-x)^(0.879812950541257) +
    (144.502549302183)*(1-x)^(1.13280361348085) +
    (-87.6858673330732)*(1-x)^(1.30792820514138) +
    (0.222816539163513)*(1-x)^(0.722791646756699) +
    (85.0495081542842)*(1-x)^(0.688662245919351) +
    (13.663221963785)*(1-x)^(0.26901625105299))));

    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end bubbleDensity;

  redeclare function extends dewDensity
    "Dew curve specific density of refrigerant (Ancillary equation)"
  protected
    Real x;

  algorithm
    x := (sat.Tsat / 369.89);

    if x >= 1 then      //test
      x := 0.999999999;
    end if;

    dv := 36.834536985497040 * (exp((1./x) *
    ((4.09277849987875)*(1-x)^(0.0307453621606038) +
    (-5.34540379169152)*(1-x)^(0.721577501314099) +
    (-3.11402125177567)*(1-x)^(0.0901724939490538) +
    (-4.49698122153491)*(1-x)^(5.52327033468354) +
    (3.29585012442182)*(1-x)^(20.0377174105058) +
    (-1.60547616316828)*(1-x)^(2.31532372381305))));

    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end dewDensity;

  redeclare function extends bubbleEnthalpy
    "Boiling curve specific enthalpy of refrigerant (Ancillary equation)"
  protected
    Real x;

  algorithm
     x := (sat.psat - (1.410067058285438e+06))/(1.172328606200022e+06);

    hl := (2.848977010741006e+05)+ (1.149782809574040e+05) *
    ((0.225687523701771) + (0.911504751253448)*x^1 +
    (-0.207637164901995)*x^2 + (0.274185673213617)*x^3 +
    (-0.00754268848532815)*x^4 + (-1.11370788409593)*x^5 +
    (0.0405468862433035)*x^6 + (3.53497666293665)*x^7 +
    (-1.23458847824892)*x^8 + (-5.46669695641973)*x^9 +
    (3.44031270765053)*x^10 + (4.15237512964778)*x^11 +
    (-4.18239153620611)*x^12 + (-0.875313076800453)*x^13 +
    (2.27869311801934)*x^14 + (-0.598842167369754)*x^15 +
    (-0.368892129682255)*x^16 + (0.271772294176198)*x^17 +
    (-0.0656754927704503)*x^18 + (0.00577519241668382)*x^19);
    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end bubbleEnthalpy;

  redeclare function extends dewEnthalpy
    "Dew curve specific enthalpy of refrigerant (Ancillary equation)"
  protected
    Real x;

  algorithm
    x := (sat.psat / (4251200));

    hv := (5.939313662559496e+05)* (exp((1./x) *
    ((-0.0336449609674175)*(1-x)^(-0.0795666320792369) +
    (0.0056115824747805)*(1-x)^(17.0146622792592) +
    (0.0409419917988476)*(1-x)^(4.26906321758232) +
    (-117.783552002934)*(1-x)^(0.706048027914744) +
    (117.769506355265)*(1-x)^(0.704661013906373))));

    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end dewEnthalpy;

  redeclare function extends bubbleEntropy
    "Boiling curve specific entropy of refrigerant (Ancillary equation)"
  protected
    Real x;

  algorithm
    x := (sat.psat - (1.410067058285438e+06))/(1.172328606200022e+06);

    sl := (1.261843878065207e+03)+ (3.695949660216577e+02)*
    (((0.295710341497624) + (0.889497230428513)*x^1 +
    (-0.292691990114568)*x^2 + (0.0446149630892932)*x^3 +
    (0.284655764511113)*x^4 + (0.653779051177121)*x^5 +
    (-1.42614875177814)*x^6 + (-1.40182390290131)*x^7 +
    (2.92349375511721)*x^8 + (1.20323374623306)*x^9 +
    (-3.42877937968545)*x^10 + (0.240405572217674)*x^11 +
    (1.93053234257814)*x^12 + (-0.844203671420036)*x^13 +
    (-0.298797990084873)*x^14 + (0.325255970626678)*x^15 +
    (-0.0923341920029435)*x^16 + (0.00913105223621009)*x^17));

    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end bubbleEntropy;

  redeclare function extends dewEntropy
    "Dew curve specific entropy of propane (Ancillary equation)"
  protected
    Real x;

  algorithm
    x := (sat.psat)/(4251200);

    sv := (2.342282001767133e+03) *
    (exp((1./x) * ((153.555001827781)*(1-x)^(1.05945977982776) +
    (-251.68092759788)*(1-x)^(1.07461813031477) +
    (-0.00115852135988614)*(1-x)^(31.0414315412162) +
    (98.2088786119097)*(1-x)^(1.09736807994395) +
    (-0.0813158904826729)*(1-x)^(-0.0567328565528613))));

    annotation(smoothOrder = 2,
          Inline=false,
          LateInline=true);
  end dewEntropy;

  redeclare replaceable function temperature_ph
    "Calculates temperature as function of pressure and specific enthalpy"
    extends Modelica.Icons.Function;
    input AbsolutePressure p "Pressure";
    input SpecificEnthalpy h "Specific enthalpy";
    input FixedPhase phase=0
      "2 for two-phase, 1 for one-phase, 0 if not known";
    output Temperature T "Temperature";

  protected
    SmoothTransition st;
    SpecificEnthalpy dh = st.T_ph;
    SpecificEnthalpy h_dew;
    SpecificEnthalpy h_bubble;
    Real x1;
    Real y1;
    Real T1;
    Real x2;
    Real y2;
    Real T2;
    Real x3;
    Real y3;
    Real x_scr;
    Real h_scr;

  algorithm
    h_dew := dewEnthalpy(sat = setSat_p(p=p));
    h_bubble := bubbleEnthalpy(sat = setSat_p(p=p));

    x_scr := (p - 5626000)/ 7.937122694444547e+05;
    h_scr := (4.922497719894971e+05) + (1.048148359001143e+04) .*
    (((-0.282362144834352) + (-0.702836054593187).*x_scr.^1 + (0.145279164630324).*x_scr.^2
     + (-0.0409012466377881).*x_scr.^3 + (0.467708180257086).*x_scr.^4 +
     (-0.243206682857801).*x_scr.^5 + (-1.79660655438524).*x_scr.^6 +
     (0.993294471341917).*x_scr.^7 + (2.38227925008323).*x_scr.^8 +
     (-1.72857104527938).*x_scr.^9 + (2.52061640312531).*x_scr.^10 +
     (0.590947343603312).*x_scr.^11 + (-11.5675227652092).*x_scr.^12 +
     (1.55577712097758).*x_scr.^13 + (14.4755596447324).*x_scr.^14 +
     (-0.632974794816523).*x_scr.^15 + (-7.4945545569486).*x_scr.^16 +
     (-3.363047277633).*x_scr.^17 + (-0.66853258243125).*x_scr.^18 +
     (5.61258037620848).*x_scr.^19 + (3.16281002861151).*x_scr.^20 +
     (-4.26523849588198).*x_scr.^21 + (-1.89919439532591).*x_scr.^22 +
     (1.86523395359451).*x_scr.^23 + (0.566509302948355).*x_scr.^24 +
     (-0.483336362426831).*x_scr.^25 + (-0.0879043728520077).*x_scr.^26 +
     (0.0692367764388313).*x_scr.^27 + (0.0056665301300182).*x_scr.^28 +
     (-0.00423790632734807).*x_scr.^29));

  if p < 4251200 then //SC, SH, SC+smooth or SH + smooth
    if h < h_bubble-dh then // SC
      x1 := (p - 4.041235488839905e+06) / (1.805274693074408e+06);
      y1 := (h - 2.486029669967999e+05) / (1.027165482267890e+05);
      T := 2.891054321927983e+02 + 38.179455046224675 *
      (0.0667794797739423 + (-0.00699248765436129).*x1.^1 +
      (-0.00089806738171536).*x1.^2 + (2.79116952445137e-05).*x1.^3 +
      (-3.53541994540162e-06).*x1.^4 + (1.16136634344803e-05).*x1.^5 +
      (-2.11810053801695e-06).*x1.^6 + (-3.7631211820926e-06).*x1.^7 +
      (1.68030035998295e-06).*x1.^8 + (6.10179700645409e-07).*x1.^9 +
      (-2.83374430672429e-07).*x1.^10 + (1.04233275843568).*y1.^1 +
      (-0.065502292185914).*y1.^2 + (-0.00304022820580418).*y1.^3 +
      (-0.000614281886402106).*y1.^4 + (-0.00153534814181972).*y1.^5 +
      (-0.000320142220802578).*y1.^6 + (0.000629203883713836).*y1.^7 +
      (-3.02977674369355e-05).*y1.^8 + (-0.000140712636885682).*y1.^9 +
      (2.8806480439184e-05).*y1.^10 + (1.17000896675711e-06).*x1.^9.*y1.^1 +
      (-2.52344165469393e-06).*x1.^8.*y1.^1 + (-2.33364870360912e-06).*x1.^8.*y1.^2
      + (-4.42818033527143e-06).*x1.^7.*y1.^1 + (6.03134578817634e-06).*x1.^7.*y1.^2
       + (3.11210124270369e-06).*x1.^7.*y1.^3 + (1.37408239930132e-05).*x1.^6.*y1.^1
        + (1.06321989624053e-06).*x1.^6.*y1.^2 + (-1.701566596351e-05).*x1.^6.*y1.^3
         + (-6.55429257142979e-06).*x1.^6.*y1.^4 +
         (-3.04459176888354e-06).*x1.^5.*y1.^1 +
         (-6.43896257694829e-05).*x1.^5.*y1.^2 +
         (-1.46458052341427e-05).*x1.^5.*y1.^3 +
         (5.75876035469035e-05).*x1.^5.*y1.^4 + (3.0534882117378e-05).*x1.^5.*y1.^5
          + (-7.33653062017981e-05).*x1.^4.*y1.^1 +
          (-4.28635130074961e-05).*x1.^4.*y1.^2 +
          (0.000190533360914324).*x1.^4.*y1.^3 +
          (0.000138332040939908).*x1.^4.*y1.^4 +
          (-0.000115380186581325).*x1.^4.*y1.^5 +
          (-8.84057055057923e-05).*x1.^4.*y1.^6 +
          (8.22732413493869e-05).*x1.^3.*y1.^1 +
          (0.000333231094747167).*x1.^3.*y1.^2 +
          (0.000272362328911319).*x1.^3.*y1.^3 +
          (-0.000325122353320865).*x1.^3.*y1.^4 +
          (-0.000315409842426006).*x1.^3.*y1.^5 +
          (0.000145843218495249).*x1.^3.*y1.^6 +
          (0.000129625534434684).*x1.^3.*y1.^7 +
          (-0.000866434442848853).*x1.^2.*y1.^1 +
          (-0.000594912567427588).*x1.^2.*y1.^2 +
          (-0.000951055451105003).*x1.^2.*y1.^3 +
          (-0.000610693426989646).*x1.^2.*y1.^4 +
          (0.000414416858260256).*x1.^2.*y1.^5 + (0.000300461026832753).*x1.^2.*y1.^6
           + (-0.00015702815740582).*x1.^2.*y1.^7 +
           (-8.82965590604829e-05).*x1.^2.*y1.^8 +
           (0.0141570965929589).*x1.^1.*y1.^1 + (0.00464881282375404).*x1.^1.*y1.^2
            + (0.0016234031338044).*x1.^1.*y1.^3 +
            (0.00145368089923057).*x1.^1.*y1.^4 +
            (0.000635450142936112).*x1.^1.*y1.^5 +
            (-0.000427714333625487).*x1.^1.*y1.^6 +
            (-0.000121017686424809).*x1.^1.*y1.^7 +
            (0.000134931121335093).*x1.^1.*y1.^8 +
            (1.6190318111643e-05).*x1.^1.*y1.^9);

    elseif h > h_dew+dh then // SH
      x2 :=(p - 1.993033647584567e+06) / (1.246082578852334e+06);
      y2 :=(h - 7.838395561703714e+05) / (1.171154308646566e+05);
      T := 3.953538152891877e+02 + 53.224991000870915 *
      (0.0199165806462969 + (0.198770382554232).*x2.^1 +
      (0.00111725115707864).*x2.^2 + (-0.000691908555438552).*x2.^3 +
      (-0.000909366922501905).*x2.^4 + (9.55527334452172e-05).*x2.^5 +
      (0.00127663464996617).*x2.^6 + (0.000145028765872037).*x2.^7 +
      (-0.00105582214305107).*x2.^8 + (-0.000205776625381625).*x2.^9 +
      (0.000482114046419216).*x2.^10 + (8.25917795104947e-05).*x2.^11 +
      (-0.000115879200021264).*x2.^12 + (-1.05044816267029e-05).*x2.^13 +
      (1.14200465341423e-05).*x2.^14 + (0.943289908549916).*y2.^1 +
      (-0.0147683157629762).*y2.^2 + (-0.00899646050938965).*y2.^3 +
      (0.00367823539277051).*y2.^4 + (-0.00210303558406399).*y2.^5 +
      (0.00150479376348649).*y2.^6 + (-0.000395311293410926).*y2.^7 +
      (-1.8356066782322e-05).*x2.^13.*y2.^1 + (1.60400992430558e-05).*x2.^12.*y2.^1
       + (1.86829154170393e-05).*x2.^12.*y2.^2 +
       (0.000198186642936795).*x2.^11.*y2.^1 +
       (-1.55851346055595e-05).*x2.^11.*y2.^2 +
       (-2.24012083181833e-05).*x2.^11.*y2.^3 +
       (-0.000133246895913022).*x2.^10.*y2.^1 +
       (-0.000191487316390308).*x2.^10.*y2.^2 +
       (1.43643009538402e-05).*x2.^10.*y2.^3 +
       (1.86604145644684e-05).*x2.^10.*y2.^4 +
       (-0.000913945958112983).*x2.^9.*y2.^1 +
       (-7.59971531851635e-05).*x2.^9.*y2.^2 +
       (0.00038201004824181).*x2.^9.*y2.^3 +
       (8.48880329179383e-05).*x2.^9.*y2.^4 +
       (-8.49406874360586e-05).*x2.^9.*y2.^5 +
       (0.000497274727819445).*x2.^8.*y2.^1 +
       (0.000793183293199249).*x2.^8.*y2.^2 +
       (-0.000242125343345563).*x2.^8.*y2.^3 +
       (-0.000134910302316591).*x2.^8.*y2.^4 +
       (3.58399662097665e-05).*x2.^8.*y2.^5 +
       (4.21152856554734e-06).*x2.^8.*y2.^6 +
       (0.00182517823094804).*x2.^7.*y2.^1 +
       (0.000544021391701596).*x2.^7.*y2.^2 +
       (-0.000727334855731105).*x2.^7.*y2.^3 +
       (-0.000246667970965596).*x2.^7.*y2.^4 +
       (-0.000171396238902948).*x2.^7.*y2.^5 +
       (-4.17138913058356e-05).*x2.^7.*y2.^6 +
       (0.000115047930827874).*x2.^7.*y2.^7 +
       (-0.00081630377475915).*x2.^6.*y2.^1 +
       (-0.00164468029057827).*x2.^6.*y2.^2 +
       (0.000514607451720926).*x2.^6.*y2.^3 +
       (0.000564546749119686).*x2.^6.*y2.^4 +
       (-2.68971970313037e-05).*x2.^6.*y2.^5 +
       (-0.000111649115100351).*x2.^6.*y2.^6 +
       (6.00488882748763e-06).*x2.^6.*y2.^7 +
       (-0.00124430406879481).*x2.^5.*y2.^1 +
       (-0.000986519355818158).*x2.^5.*y2.^2 + (-0.000835143374354054).*x2.^5.*y2.^3
        + (0.000324769874023618).*x2.^5.*y2.^4 + (0.00156757459990079).*x2.^5.*y2.^5
         + (-5.16658043521629e-06).*x2.^5.*y2.^6 +
         (-0.000382168797159261).*x2.^5.*y2.^7 +
         (0.000724065645847293).*x2.^4.*y2.^1 + (0.00138214226217219).*x2.^4.*y2.^2
          + (-7.43784151653557e-05).*x2.^4.*y2.^3 +
          (-0.00100757179713038).*x2.^4.*y2.^4 +
          (8.38086674336547e-05).*x2.^4.*y2.^5 +
          (0.000103947886586524).*x2.^4.*y2.^6 +
          (2.20976949609885e-05).*x2.^4.*y2.^7 +
          (0.000462684393586026).*x2.^3.*y2.^1 +
          (0.000436499334700305).*x2.^3.*y2.^2 +
          (0.00207821165260908).*x2.^3.*y2.^3 +
          (-0.000516122451734289).*x2.^3.*y2.^4 +
          (-0.00155000082823923).*x2.^3.*y2.^5 +
          (-9.08247883578407e-05).*x2.^3.*y2.^6 +
          (0.000399766408481043).*x2.^3.*y2.^7 +
          (-0.00197660157456033).*x2.^2.*y2.^1 +
          (0.000517545938534115).*x2.^2.*y2.^2 +
          (-0.000967421446194703).*x2.^2.*y2.^3 +
           (0.00150864424440146).*x2.^2.*y2.^4 +
           (-0.000472984492835484).*x2.^2.*y2.^5 +
           (-0.000102892781370082).*x2.^2.*y2.^6 +
            (3.91885305936409e-05).*x2.^2.*y2.^7 +
            (-0.0908757206212324).*x2.^1.*y2.^1 +
            (0.0356104760914229).*x2.^1.*y2.^2 +
            (-0.013057565991819).*x2.^1.*y2.^3 +
            (0.00487268862430578).*x2.^1.*y2.^4 +
            (-0.00218035397458454).*x2.^1.*y2.^5 +
             (0.0011081247234808).*x2.^1.*y2.^6 +
             (-0.000284132135936153).*x2.^1.*y2.^7);

    elseif h < h_bubble then //SC + smooth
      x1 := (p - 4.041235488839905e+06) / (1.805274693074408e+06);
      y1 := (h - 2.486029669967999e+05) / (1.027165482267890e+05);
      T1 := 2.891054321927983e+02 + 38.179455046224675 *
      (0.0667794797739423 + (-0.00699248765436129).*x1.^1 +
      (-0.00089806738171536).*x1.^2 + (2.79116952445137e-05).*x1.^3 +
      (-3.53541994540162e-06).*x1.^4 + (1.16136634344803e-05).*x1.^5 +
      (-2.11810053801695e-06).*x1.^6 + (-3.7631211820926e-06).*x1.^7 +
      (1.68030035998295e-06).*x1.^8 + (6.10179700645409e-07).*x1.^9 +
      (-2.83374430672429e-07).*x1.^10 + (1.04233275843568).*y1.^1 +
      (-0.065502292185914).*y1.^2 + (-0.00304022820580418).*y1.^3 +
      (-0.000614281886402106).*y1.^4 + (-0.00153534814181972).*y1.^5 +
      (-0.000320142220802578).*y1.^6 + (0.000629203883713836).*y1.^7 +
      (-3.02977674369355e-05).*y1.^8 + (-0.000140712636885682).*y1.^9 +
      (2.8806480439184e-05).*y1.^10 + (1.17000896675711e-06).*x1.^9.*y1.^1 +
      (-2.52344165469393e-06).*x1.^8.*y1.^1 + (-2.33364870360912e-06).*x1.^8.*y1.^2
      + (-4.42818033527143e-06).*x1.^7.*y1.^1 + (6.03134578817634e-06).*x1.^7.*y1.^2
       + (3.11210124270369e-06).*x1.^7.*y1.^3 + (1.37408239930132e-05).*x1.^6.*y1.^1
        + (1.06321989624053e-06).*x1.^6.*y1.^2 + (-1.701566596351e-05).*x1.^6.*y1.^3
         + (-6.55429257142979e-06).*x1.^6.*y1.^4 +
         (-3.04459176888354e-06).*x1.^5.*y1.^1 +
         (-6.43896257694829e-05).*x1.^5.*y1.^2 +
         (-1.46458052341427e-05).*x1.^5.*y1.^3 +
         (5.75876035469035e-05).*x1.^5.*y1.^4 + (3.0534882117378e-05).*x1.^5.*y1.^5
          + (-7.33653062017981e-05).*x1.^4.*y1.^1 +
          (-4.28635130074961e-05).*x1.^4.*y1.^2 +
          (0.000190533360914324).*x1.^4.*y1.^3 +
          (0.000138332040939908).*x1.^4.*y1.^4 +
          (-0.000115380186581325).*x1.^4.*y1.^5 +
          (-8.84057055057923e-05).*x1.^4.*y1.^6 +
          (8.22732413493869e-05).*x1.^3.*y1.^1 +
          (0.000333231094747167).*x1.^3.*y1.^2 +
          (0.000272362328911319).*x1.^3.*y1.^3 +
          (-0.000325122353320865).*x1.^3.*y1.^4 +
          (-0.000315409842426006).*x1.^3.*y1.^5 +
          (0.000145843218495249).*x1.^3.*y1.^6 +
          (0.000129625534434684).*x1.^3.*y1.^7 +
          (-0.000866434442848853).*x1.^2.*y1.^1 +
          (-0.000594912567427588).*x1.^2.*y1.^2 +
          (-0.000951055451105003).*x1.^2.*y1.^3 +
          (-0.000610693426989646).*x1.^2.*y1.^4 +
          (0.000414416858260256).*x1.^2.*y1.^5 + (0.000300461026832753).*x1.^2.*y1.^6
           + (-0.00015702815740582).*x1.^2.*y1.^7 +
           (-8.82965590604829e-05).*x1.^2.*y1.^8 +
           (0.0141570965929589).*x1.^1.*y1.^1 + (0.00464881282375404).*x1.^1.*y1.^2
            + (0.0016234031338044).*x1.^1.*y1.^3 +
            (0.00145368089923057).*x1.^1.*y1.^4 +
            (0.000635450142936112).*x1.^1.*y1.^5 +
            (-0.000427714333625487).*x1.^1.*y1.^6 +
            (-0.000121017686424809).*x1.^1.*y1.^7 +
            (0.000134931121335093).*x1.^1.*y1.^8 +
            (1.6190318111643e-05).*x1.^1.*y1.^9);

      T :=saturationTemperature(p)*(1 - (h_bubble - h)/dh) +
      T1*(h_bubble - h)/dh;
    elseif h > h_dew then //SH + smooth
      x2 :=(p - 1.993033647584567e+06) / (1.246082578852334e+06);
      y2 :=(h - 7.838395561703714e+05) / (1.171154308646566e+05);
      T2 := 3.953538152891877e+02 + 53.224991000870915 *
      (0.0199165806462969 + (0.198770382554232).*x2.^1 +
      (0.00111725115707864).*x2.^2 + (-0.000691908555438552).*x2.^3 +
      (-0.000909366922501905).*x2.^4 + (9.55527334452172e-05).*x2.^5 +
      (0.00127663464996617).*x2.^6 + (0.000145028765872037).*x2.^7 +
      (-0.00105582214305107).*x2.^8 + (-0.000205776625381625).*x2.^9 +
      (0.000482114046419216).*x2.^10 + (8.25917795104947e-05).*x2.^11 +
      (-0.000115879200021264).*x2.^12 + (-1.05044816267029e-05).*x2.^13 +
      (1.14200465341423e-05).*x2.^14 + (0.943289908549916).*y2.^1 +
      (-0.0147683157629762).*y2.^2 + (-0.00899646050938965).*y2.^3 +
      (0.00367823539277051).*y2.^4 + (-0.00210303558406399).*y2.^5 +
      (0.00150479376348649).*y2.^6 + (-0.000395311293410926).*y2.^7 +
      (-1.8356066782322e-05).*x2.^13.*y2.^1 + (1.60400992430558e-05).*x2.^12.*y2.^1
       + (1.86829154170393e-05).*x2.^12.*y2.^2 +
       (0.000198186642936795).*x2.^11.*y2.^1 +
       (-1.55851346055595e-05).*x2.^11.*y2.^2 +
       (-2.24012083181833e-05).*x2.^11.*y2.^3 +
       (-0.000133246895913022).*x2.^10.*y2.^1 +
       (-0.000191487316390308).*x2.^10.*y2.^2 +
       (1.43643009538402e-05).*x2.^10.*y2.^3 +
       (1.86604145644684e-05).*x2.^10.*y2.^4 +
       (-0.000913945958112983).*x2.^9.*y2.^1 +
       (-7.59971531851635e-05).*x2.^9.*y2.^2 +
       (0.00038201004824181).*x2.^9.*y2.^3 +
       (8.48880329179383e-05).*x2.^9.*y2.^4 +
       (-8.49406874360586e-05).*x2.^9.*y2.^5 +
       (0.000497274727819445).*x2.^8.*y2.^1 +
       (0.000793183293199249).*x2.^8.*y2.^2 +
       (-0.000242125343345563).*x2.^8.*y2.^3 +
       (-0.000134910302316591).*x2.^8.*y2.^4 +
       (3.58399662097665e-05).*x2.^8.*y2.^5 +
       (4.21152856554734e-06).*x2.^8.*y2.^6 +
       (0.00182517823094804).*x2.^7.*y2.^1 +
       (0.000544021391701596).*x2.^7.*y2.^2 +
       (-0.000727334855731105).*x2.^7.*y2.^3 +
       (-0.000246667970965596).*x2.^7.*y2.^4 +
       (-0.000171396238902948).*x2.^7.*y2.^5 +
       (-4.17138913058356e-05).*x2.^7.*y2.^6 +
       (0.000115047930827874).*x2.^7.*y2.^7 +
       (-0.00081630377475915).*x2.^6.*y2.^1 +
       (-0.00164468029057827).*x2.^6.*y2.^2 +
       (0.000514607451720926).*x2.^6.*y2.^3 +
       (0.000564546749119686).*x2.^6.*y2.^4 +
       (-2.68971970313037e-05).*x2.^6.*y2.^5 +
       (-0.000111649115100351).*x2.^6.*y2.^6 +
       (6.00488882748763e-06).*x2.^6.*y2.^7 +
       (-0.00124430406879481).*x2.^5.*y2.^1 +
       (-0.000986519355818158).*x2.^5.*y2.^2 + (-0.000835143374354054).*x2.^5.*y2.^3
        + (0.000324769874023618).*x2.^5.*y2.^4 + (0.00156757459990079).*x2.^5.*y2.^5
         + (-5.16658043521629e-06).*x2.^5.*y2.^6 +
         (-0.000382168797159261).*x2.^5.*y2.^7 +
         (0.000724065645847293).*x2.^4.*y2.^1 + (0.00138214226217219).*x2.^4.*y2.^2
          + (-7.43784151653557e-05).*x2.^4.*y2.^3 +
          (-0.00100757179713038).*x2.^4.*y2.^4 +
          (8.38086674336547e-05).*x2.^4.*y2.^5 +
          (0.000103947886586524).*x2.^4.*y2.^6 +
          (2.20976949609885e-05).*x2.^4.*y2.^7 +
          (0.000462684393586026).*x2.^3.*y2.^1 +
          (0.000436499334700305).*x2.^3.*y2.^2 +
          (0.00207821165260908).*x2.^3.*y2.^3 +
          (-0.000516122451734289).*x2.^3.*y2.^4 +
          (-0.00155000082823923).*x2.^3.*y2.^5 +
          (-9.08247883578407e-05).*x2.^3.*y2.^6 +
          (0.000399766408481043).*x2.^3.*y2.^7 +
          (-0.00197660157456033).*x2.^2.*y2.^1 +
          (0.000517545938534115).*x2.^2.*y2.^2 +
          (-0.000967421446194703).*x2.^2.*y2.^3 +
           (0.00150864424440146).*x2.^2.*y2.^4 +
           (-0.000472984492835484).*x2.^2.*y2.^5 +
           (-0.000102892781370082).*x2.^2.*y2.^6 +
            (3.91885305936409e-05).*x2.^2.*y2.^7 +
            (-0.0908757206212324).*x2.^1.*y2.^1 +
            (0.0356104760914229).*x2.^1.*y2.^2 +
            (-0.013057565991819).*x2.^1.*y2.^3 +
            (0.00487268862430578).*x2.^1.*y2.^4 +
            (-0.00218035397458454).*x2.^1.*y2.^5 +
             (0.0011081247234808).*x2.^1.*y2.^6 +
             (-0.000284132135936153).*x2.^1.*y2.^7);

      T := saturationTemperature(p) * (1- (h-h_dew)/dh) + T2*(h-h_dew)/dh;

    else T := saturationTemperature(p);
    end if;

  elseif h < h_scr then //SC
      x1 := (p - 4.041235488839905e+06) / (1.805274693074408e+06);
      y1 := (h - 2.486029669967999e+05) / (1.027165482267890e+05);
      T := 2.891054321927983e+02 + 38.179455046224675 *
      (0.0667794797739423 + (-0.00699248765436129).*x1.^1 +
      (-0.00089806738171536).*x1.^2 + (2.79116952445137e-05).*x1.^3 +
      (-3.53541994540162e-06).*x1.^4 + (1.16136634344803e-05).*x1.^5 +
      (-2.11810053801695e-06).*x1.^6 + (-3.7631211820926e-06).*x1.^7 +
      (1.68030035998295e-06).*x1.^8 + (6.10179700645409e-07).*x1.^9 +
      (-2.83374430672429e-07).*x1.^10 + (1.04233275843568).*y1.^1 +
      (-0.065502292185914).*y1.^2 + (-0.00304022820580418).*y1.^3 +
      (-0.000614281886402106).*y1.^4 + (-0.00153534814181972).*y1.^5 +
      (-0.000320142220802578).*y1.^6 + (0.000629203883713836).*y1.^7 +
      (-3.02977674369355e-05).*y1.^8 + (-0.000140712636885682).*y1.^9 +
      (2.8806480439184e-05).*y1.^10 + (1.17000896675711e-06).*x1.^9.*y1.^1 +
      (-2.52344165469393e-06).*x1.^8.*y1.^1 + (-2.33364870360912e-06).*x1.^8.*y1.^2
      + (-4.42818033527143e-06).*x1.^7.*y1.^1 + (6.03134578817634e-06).*x1.^7.*y1.^2
       + (3.11210124270369e-06).*x1.^7.*y1.^3 + (1.37408239930132e-05).*x1.^6.*y1.^1
        + (1.06321989624053e-06).*x1.^6.*y1.^2 + (-1.701566596351e-05).*x1.^6.*y1.^3
         + (-6.55429257142979e-06).*x1.^6.*y1.^4 +
         (-3.04459176888354e-06).*x1.^5.*y1.^1 +
         (-6.43896257694829e-05).*x1.^5.*y1.^2 +
         (-1.46458052341427e-05).*x1.^5.*y1.^3 +
         (5.75876035469035e-05).*x1.^5.*y1.^4 + (3.0534882117378e-05).*x1.^5.*y1.^5
          + (-7.33653062017981e-05).*x1.^4.*y1.^1 +
          (-4.28635130074961e-05).*x1.^4.*y1.^2 +
          (0.000190533360914324).*x1.^4.*y1.^3 +
          (0.000138332040939908).*x1.^4.*y1.^4 +
          (-0.000115380186581325).*x1.^4.*y1.^5 +
          (-8.84057055057923e-05).*x1.^4.*y1.^6 +
          (8.22732413493869e-05).*x1.^3.*y1.^1 +
          (0.000333231094747167).*x1.^3.*y1.^2 +
          (0.000272362328911319).*x1.^3.*y1.^3 +
          (-0.000325122353320865).*x1.^3.*y1.^4 +
          (-0.000315409842426006).*x1.^3.*y1.^5 +
          (0.000145843218495249).*x1.^3.*y1.^6 +
          (0.000129625534434684).*x1.^3.*y1.^7 +
          (-0.000866434442848853).*x1.^2.*y1.^1 +
          (-0.000594912567427588).*x1.^2.*y1.^2 +
          (-0.000951055451105003).*x1.^2.*y1.^3 +
          (-0.000610693426989646).*x1.^2.*y1.^4 +
          (0.000414416858260256).*x1.^2.*y1.^5 + (0.000300461026832753).*x1.^2.*y1.^6
           + (-0.00015702815740582).*x1.^2.*y1.^7 +
           (-8.82965590604829e-05).*x1.^2.*y1.^8 +
           (0.0141570965929589).*x1.^1.*y1.^1 + (0.00464881282375404).*x1.^1.*y1.^2
            + (0.0016234031338044).*x1.^1.*y1.^3 +
            (0.00145368089923057).*x1.^1.*y1.^4 +
            (0.000635450142936112).*x1.^1.*y1.^5 +
            (-0.000427714333625487).*x1.^1.*y1.^6 +
            (-0.000121017686424809).*x1.^1.*y1.^7 +
            (0.000134931121335093).*x1.^1.*y1.^8 +
            (1.6190318111643e-05).*x1.^1.*y1.^9);

  elseif h > h_scr then //SCr
    x3 := (log(p) - 15.535422275045061) / (0.144590303358003);
    y3 := (h - 7.881629843766176e+05) / (1.350198232708690e+05);
    T :=  4.336055951451353e+02 + 37.263139287111660 *
    (-0.16358209782975 + (0.16311603387729).*x3.^1 + (0.00657070920386759).*x3.^2
     + (-0.000570692813108221).*x3.^3 + (-0.000136283949334854).*x3.^4 +
     (-2.94241666287847e-05).*x3.^5 + (3.20773656974635e-06).*x3.^6 +
     (5.13425896069857e-07).*x3.^7 + (-4.64222081251836e-07).*x3.^8 +
     (1.14969941240401).*y3.^1 + (0.135883343045317).*y3.^2 +
     (-0.0749095952359018).*y3.^3 + (0.0243888631213305).*y3.^4 +
      (-0.00877364044709287).*y3.^5 + (0.00218950101341039).*y3.^6 +
      (0.00760950878723978).*y3.^7 + (-0.00705935940951355).*y3.^8 +
      (-0.00104834012886866).*y3.^9 + (0.00210029532120558).*y3.^10 +
      (0.000144550119737633).*y3.^11 + (-0.000223293003197404).*y3.^12 +
      (-3.20530925373026e-05).*y3.^13 + (0.000137662744666666).*y3.^12.*x3.^1 +
       (0.000351694819837377).*y3.^11.*x3.^1 + (-4.62626617086914e-05).*y3.^11.*x3.^2
        + (-0.00127736250875627).*y3.^10.*x3.^1 +
        (3.71832608265825e-05).*y3.^10.*x3.^2 + (-1.4797902272449e-05).*y3.^10.*x3.^3
         + (-0.00237192887422631).*y3.^9.*x3.^1 +
         (0.000731647010213273).*y3.^9.*x3.^2 + (-9.51260281188978e-05).*y3.^9.*x3.^3
          + (-4.9907017225352e-05).*y3.^9.*x3.^4 +
          (0.00567405154852059).*y3.^8.*x3.^1 + (-0.000542342261492773).*y3.^8.*x3.^2
          + (0.000198276675471127).*y3.^8.*x3.^3 +
          (-4.49938869129133e-05).*y3.^8.*x3.^4 +
          (-5.58022314216642e-05).*y3.^8.*x3.^5 +
          (0.00304889552154597).*y3.^7.*x3.^1 +
          (-0.00315980866044).*y3.^7.*x3.^2 +
          (0.000959291023672596).*y3.^7.*x3.^3 +
          (0.000294370789377926).*y3.^7.*x3.^4 +
          (-7.16225245694404e-05).*y3.^7.*x3.^5 +
          (-7.12235951096106e-06).*y3.^7.*x3.^6 +
          (-0.0111446408382533).*y3.^6.*x3.^1 + (0.00337873442306413).*y3.^6.*x3.^2
           + (-0.00108915724963852).*y3.^6.*x3.^3 +
           (0.000149413378543835).*y3.^6.*x3.^4 +
           (0.000319862081302399).*y3.^6.*x3.^5 +
           (-1.17107599384629e-06).*y3.^6.*x3.^6 +
           (-1.94007786819952e-06).*y3.^6.*x3.^7 +
           (0.00886901546989354).*y3.^5.*x3.^1 +
           (0.00293608754848822).*y3.^5.*x3.^2 +
           (-0.00283892271774696).*y3.^5.*x3.^3 +
           (-0.000495466944829968).*y3.^5.*x3.^4 +
           (0.000297549108339092).*y3.^5.*x3.^5 +
           (3.49922835395354e-05).*y3.^5.*x3.^6 +
            (-3.16912000709171e-06).*y3.^5.*x3.^7 +
            (-5.89435817682745e-07).*y3.^5.*x3.^8 +
            (-0.00685355006784846).*y3.^4.*x3.^1 +
            (-0.00570065900025576).*y3.^4.*x3.^2 +
            (0.0029808418208915).*y3.^4.*x3.^3 +
            (-0.000152029520189021).*y3.^4.*x3.^4 +
            (-0.000611341752442035).*y3.^4.*x3.^5 +
            (9.10717506812267e-06).*y3.^4.*x3.^6 +
            (7.22435886564606e-06).*y3.^4.*x3.^7 +
            (-2.08408449093877e-06).*y3.^4.*x3.^8 +
            (0.00212433851653477).*y3.^3.*x3.^1 +
            (0.00522088103294511).*y3.^3.*x3.^2 +
            (0.0019488896592734).*y3.^3.*x3.^3 +
            (0.000115806483746211).*y3.^3.*x3.^4 +
            (-0.000304268351643378).*y3.^3.*x3.^5 +
            (-5.3062212441428e-05).*y3.^3.*x3.^6 +
            (7.28720725998143e-06).*y3.^3.*x3.^7 +
            (3.40496725151938e-06).*y3.^3.*x3.^8 +
            (0.0190457240562489).*y3.^2.*x3.^1 +
            (-0.00552581243677282).*y3.^2.*x3.^2 +
            (-0.00258784130269838).*y3.^2.*x3.^3 +
            (0.000253149931348535).*y3.^2.*x3.^4 +
            (0.000378690531514138).*y3.^2.*x3.^5 +
            (-1.33614720162282e-05).*y3.^2.*x3.^6 +
            (-5.29596104412999e-06).*y3.^2.*x3.^7 +
            (3.3742936086516e-06).*y3.^2.*x3.^8 +
            (-0.0726215195825288).*y3.^1.*x3.^1 + (0.00208238847063311).*y3.^1.*x3.^2
             + (0.00115525694054568).*y3.^1.*x3.^3 +
             (2.38548474213429e-05).*y3.^1.*x3.^4 +
             (4.57706827371236e-05).*y3.^1.*x3.^5 +
             (2.19489428836878e-05).*y3.^1.*x3.^6 +
             (-3.75120338621543e-06).*y3.^1.*x3.^7 +
             (-2.93697133922035e-06).*y3.^1.*x3.^8);

  end if;

    annotation(derivative(noDerivative=phase)=temperature_ph_der,
          inverse(h=specificEnthalpy_pT(p=p,T=T,phase=phase)),
          Inline=false,
          LateInline=true);
  end temperature_ph;

  redeclare replaceable function temperature_ps
    "Calculates temperature as function of pressure and specific entroy"
    extends Modelica.Icons.Function;
    input AbsolutePressure p "Pressure";
    input SpecificEntropy s "Specific entropy";
    input FixedPhase phase = 0
      "2 for two-phase, 1 for one-phase, 0 if not known";
    output Temperature T "Temperature";

  protected
    SmoothTransition st;
    SpecificEntropy ds = st.T_ps;
    SpecificEntropy s_dew;
    SpecificEntropy s_bubble;
    Real x1;
    Real y1;
    Real T1;
    Real x2;
    Real x3;
    Real y2;
    Real y3;
    Real T2;
    Real T3;
    Real x_scr;
    Real s_scr;

  algorithm
    s_dew := dewEntropy(sat = setSat_p(p=p));
    s_bubble := bubbleEntropy(sat = setSat_p(p=p));
    x_scr :=(p - 5626000)/7.937122694444547e+05;
    s_scr := (1.870199957875619e+03) + (34.138593515726015) .*
    (((-0.239156592736578) + (-0.756965118056926).*x_scr.^1 + (0.119891474816471).*x_scr.^2
     + (-0.106352759748811).*x_scr.^3 + (0.405065938996309).*x_scr.^4 +
     (0.213374055450552).*x_scr.^5 + (-1.39218693566677).*x_scr.^6 +
     (-0.293913518394027).*x_scr.^7 + (1.50818369433276).*x_scr.^8 +
     (0.164246282068212).*x_scr.^9 + (2.16146816298444).*x_scr.^10 +
     (-0.567753752665742).*x_scr.^11 + (-6.68690511395015).*x_scr.^12 +
     (0.814240662425489).*x_scr.^13 + (4.5287835045782).*x_scr.^14 +
     (1.54520446756266).*x_scr.^15 + (3.37748004351035).*x_scr.^16 +
     (-5.48430183712515).*x_scr.^17 + (-8.09739835350756).*x_scr.^18 +
     (6.79795835933678).*x_scr.^19 + (6.47675839457534).*x_scr.^20 +
     (-4.66588003432765).*x_scr.^21 + (-2.86313860277241).*x_scr.^22 +
     (1.94022099649453).*x_scr.^23 + (0.742181765530618).*x_scr.^24 +
     (-0.487951981013531).*x_scr.^25 + (-0.106009587298149).*x_scr.^26 +
     (0.0685130852787585).*x_scr.^27 + (0.00646406544216233).*x_scr.^28 +
     (-0.0041328765121112).*x_scr.^29));

    if  p < 4251200 then //SC, SH, SC+smooth or SH+smooth
      if s < s_bubble - ds then //SC
        x1 :=(log(p) - 14.956558198193330) / (0.745141086421202);
        y1 :=(s - 7.909838086570759e+02) / (4.937245780066642e+02);
        T := 2.538593397712641e+02 + 52.627656402667306 *
        ( -0.0431022969051216 + (0.0179549192591948).*x1.^1 +
        (0.00667029172008691).*x1.^2 + (0.00215800574698055).*x1.^3 +
        (0.00010313283801039).*x1.^4 + (-0.000681105144906593).*x1.^5 +
        (-0.000113923009178591).*x1.^6 + (0.000292366941254834).*x1.^7 +
         (0.000182493953945194).*x1.^8 + (4.35626066075309e-05).*x1.^9 +
         (4.54413228418679e-06).*x1.^10 + (1.67377971230446e-07).*x1.^11 +
         (1.01369000697853).*y1.^1 + (0.0475233267067756).*y1.^2 +
         (-0.0138176331024103).*y1.^3 + (-0.00606945795313334).*y1.^4 +
         (-0.000497652432019186).*y1.^5 + (0.00185495500161636).*y1.^6 +
          (-0.000126105501159687).*y1.^7 + (-0.000455255339273504).*y1.^8 +
           (1.85406957305218e-06).*x1.^10.*y1.^1 + (1.98221008294585e-05).*x1.^9.*y1.^1
            + (-6.12796499036914e-06).*x1.^9.*y1.^2 +
            (1.08254834564334e-05).*x1.^8.*y1.^1 +
            (-0.000116056764276753).*x1.^8.*y1.^2 +
            (-8.28823578117116e-06).*x1.^8.*y1.^3 +
            (-0.00042045785286443).*x1.^7.*y1.^1 +
             (-0.00043701152278637).*x1.^7.*y1.^2 +
             (0.000216091315683604).*x1.^7.*y1.^3 +
              (9.38720952997965e-05).*x1.^7.*y1.^4 +
              (-0.00134042271964956).*x1.^6.*y1.^1 +
              (-1.05010232920484e-05).*x1.^6.*y1.^2 +
              (0.00115127202911589).*x1.^6.*y1.^3 +
              (-4.59875470589928e-05).*x1.^6.*y1.^4 +
              (-0.000233055941744266).*x1.^6.*y1.^5 +
              (-0.000557033119514029).*x1.^5.*y1.^1 +
              (0.00194058204377519).*x1.^5.*y1.^2 +
              (0.000722268449138769).*x1.^5.*y1.^3 +
              (-0.00164776647352168).*x1.^5.*y1.^4 +
              (-0.00046950710947453).*x1.^5.*y1.^5 +
              (0.000251625159197325).*x1.^5.*y1.^6 +
              (0.00248548217241555).*x1.^4.*y1.^1 +
              (0.0012085435953491).*x1.^4.*y1.^2 +
              (-0.00379662549122131).*x1.^4.*y1.^3 +
               (-0.00219018959183556).*x1.^4.*y1.^4 +
                (0.00164280993888601).*x1.^4.*y1.^5 +
                (0.00106364047467776).*x1.^4.*y1.^6 +
                (-3.46897116400914e-05).*x1.^4.*y1.^7 +
                (0.00261428534050651).*x1.^3.*y1.^1 +
                (-0.00340704470230764).*x1.^3.*y1.^2 +
                (-0.00431959089300383).*x1.^3.*y1.^3 +
                (0.004270466576964).*x1.^3.*y1.^4 +
                (0.00409709459963298).*x1.^3.*y1.^5 +
                (-0.00102132259059102).*x1.^3.*y1.^6 +
                (-0.00114708926095014).*x1.^3.*y1.^7 +
                (-9.99663705953223e-05).*x1.^3.*y1.^8 +
                (0.00180198462867549).*x1.^2.*y1.^1 +
                (-0.00168869775554094).*x1.^2.*y1.^2 +
                (0.00374499860846725).*x1.^2.*y1.^3 +
                (0.00613394294955581).*x1.^2.*y1.^4 +
                (-0.00236844954704366).*x1.^2.*y1.^5 +
                (-0.00379427819361451).*x1.^2.*y1.^6 +
                (0.000470331100806254).*x1.^2.*y1.^7 +
                (0.000688938947068089).*x1.^2.*y1.^8 +
                (0.00834461401542405).*x1.^1.*y1.^1 +
                (0.00545577299602364).*x1.^1.*y1.^2 +
                (0.00372337046173214).*x1.^1.*y1.^3 +
                (-0.00178495242496634).*x1.^1.*y1.^4 +
                (-0.00171135536320274).*x1.^1.*y1.^5 +
                (0.00118588644837419).*x1.^1.*y1.^6 +
                (0.000644998823851516).*x1.^1.*y1.^7 +
                (-7.83183304358888e-05).*x1.^1.*y1.^8);
      elseif s > s_dew + ds then //SH
        x2 :=(log(p) - 14.318501326731946) / (0.828373286397511);
        y2 :=(s - 3.078745756126676e+03) / (4.985098646537616e+02);
        T :=4.514567959585206e+02 + 93.462374188837520 *
        (-0.0708789791814325 + (0.367344112173224).*x2.^1 + (0.0186506581958736).*x2.^2
         + (0.00318899964669977).*x2.^3 + (0.000282547216289501).*x2.^4 +
         (0.00048257943328371).*x2.^5 + (0.000207212968165932).*x2.^6 +
         (-0.00011204549955888).*x2.^7 + (-9.37532514875432e-05).*x2.^8 +
         (-2.21859848344187e-05).*x2.^9 + (-1.78713841100843e-06).*x2.^10 +
          (0.97998714093717).*y2.^1 + (0.0386089222118281).*y2.^2 +
          (-0.0106585516545686).*y2.^3 + (0.00772902980120626).*y2.^4 +
          (0.00416990875506986).*y2.^5 + (-0.00475638838258409).*y2.^6 +
          (-0.00274575690445518).*y2.^7 + (0.00230101477849377).*y2.^8 +
          (0.000399323349319408).*y2.^9 + (-0.000327918311504147).*y2.^10 +
          (5.86089845545948e-06).*x2.^9.*y2.^1 + (6.71148372390456e-05).*x2.^8.*y2.^1
           + (-1.31112550105755e-05).*x2.^8.*y2.^2 + (0.000247682806790645).*x2.^7.*y2.^1
            + (-0.000136195976516863).*x2.^7.*y2.^2 + (2.3871645866491e-05).*x2.^7.*y2.^3
             + (0.00017616387019545).*x2.^6.*y2.^1 +
              (-0.000417154091956214).*x2.^6.*y2.^2 +
              (0.000220714180360342).*x2.^6.*y2.^3 +
              (-3.81215880969989e-05).*x2.^6.*y2.^4 +
              (-0.000735687508573633).*x2.^5.*y2.^1 +
              (-2.76790494582083e-05).*x2.^5.*y2.^2 +
              (0.000533886747710054).*x2.^5.*y2.^3 +
               (-0.000293837270968734).*x2.^5.*y2.^4 +
               (4.53485017787078e-05).*x2.^5.*y2.^5 +
               (-0.00112104861670486).*x2.^4.*y2.^1 +
               (0.00153853546134664).*x2.^4.*y2.^2 +
                (-0.000375926035064792).*x2.^4.*y2.^3 +
                (-0.000434206090275352).*x2.^4.*y2.^4 +
                (0.00030063485655704).*x2.^4.*y2.^5 +
                (-6.1841693279203e-05).*x2.^4.*y2.^6 +
                (-0.000959207010895185).*x2.^3.*y2.^1 +
                (0.00140884465599109).*x2.^3.*y2.^2 +
                (-0.00221804089648952).*x2.^3.*y2.^3 +
                (0.000981059478332076).*x2.^3.*y2.^4 +
                (0.000255273394929837).*x2.^3.*y2.^5 +
                (-0.000247778476130309).*x2.^3.*y2.^6 +
                (3.11728827474846e-05).*x2.^3.*y2.^7 +
                (-0.00766505741740397).*x2.^2.*y2.^1 +
                (0.00265733435406909).*x2.^2.*y2.^2 +
                (-0.00155572960179254).*x2.^2.*y2.^3 +
                (0.0016900398616944).*x2.^2.*y2.^4 +
                (-0.00111245201052813).*x2.^2.*y2.^5 +
                (0.000312430869779947).*x2.^2.*y2.^6 +
                (6.64513314960078e-05).*x2.^2.*y2.^7 +
                (-4.63505461261904e-05).*x2.^2.*y2.^8 +
                (-0.0131732391690461).*x2.^1.*y2.^1 +
                 (0.0130047445328901).*x2.^1.*y2.^2 +
                 (-0.00376724817530576).*x2.^1.*y2.^3 +
                 (7.310764241185e-05).*x2.^1.*y2.^4 +
                 (-5.23162970709533e-05).*x2.^1.*y2.^5 +
                 (0.000938157703231561).*x2.^1.*y2.^6 +
                 (-0.000584332452006185).*x2.^1.*y2.^7 +
                 (5.44118357554665e-05).*x2.^1.*y2.^8 +
                 (2.09307877783523e-05).*x2.^1.*y2.^9);
      elseif s < s_bubble then //SC+smooth
        x1 :=(log(p) - 14.956558198193330) / (0.745141086421202);
        y1 :=(s - 7.909838086570759e+02) / (4.937245780066642e+02);
        T1 := 2.538593397712641e+02 + 52.627656402667306 *
        ( -0.0431022969051216 + (0.0179549192591948).*x1.^1 +
        (0.00667029172008691).*x1.^2 + (0.00215800574698055).*x1.^3 +
        (0.00010313283801039).*x1.^4 + (-0.000681105144906593).*x1.^5 +
        (-0.000113923009178591).*x1.^6 + (0.000292366941254834).*x1.^7 +
         (0.000182493953945194).*x1.^8 + (4.35626066075309e-05).*x1.^9 +
         (4.54413228418679e-06).*x1.^10 + (1.67377971230446e-07).*x1.^11 +
         (1.01369000697853).*y1.^1 + (0.0475233267067756).*y1.^2 +
         (-0.0138176331024103).*y1.^3 + (-0.00606945795313334).*y1.^4 +
         (-0.000497652432019186).*y1.^5 + (0.00185495500161636).*y1.^6 +
          (-0.000126105501159687).*y1.^7 + (-0.000455255339273504).*y1.^8 +
           (1.85406957305218e-06).*x1.^10.*y1.^1 + (1.98221008294585e-05).*x1.^9.*y1.^1
            + (-6.12796499036914e-06).*x1.^9.*y1.^2 +
            (1.08254834564334e-05).*x1.^8.*y1.^1 +
            (-0.000116056764276753).*x1.^8.*y1.^2 +
            (-8.28823578117116e-06).*x1.^8.*y1.^3 +
            (-0.00042045785286443).*x1.^7.*y1.^1 +
             (-0.00043701152278637).*x1.^7.*y1.^2 +
             (0.000216091315683604).*x1.^7.*y1.^3 +
              (9.38720952997965e-05).*x1.^7.*y1.^4 +
              (-0.00134042271964956).*x1.^6.*y1.^1 +
              (-1.05010232920484e-05).*x1.^6.*y1.^2 +
              (0.00115127202911589).*x1.^6.*y1.^3 +
              (-4.59875470589928e-05).*x1.^6.*y1.^4 +
              (-0.000233055941744266).*x1.^6.*y1.^5 +
              (-0.000557033119514029).*x1.^5.*y1.^1 +
              (0.00194058204377519).*x1.^5.*y1.^2 +
              (0.000722268449138769).*x1.^5.*y1.^3 +
              (-0.00164776647352168).*x1.^5.*y1.^4 +
              (-0.00046950710947453).*x1.^5.*y1.^5 +
              (0.000251625159197325).*x1.^5.*y1.^6 +
              (0.00248548217241555).*x1.^4.*y1.^1 +
              (0.0012085435953491).*x1.^4.*y1.^2 +
              (-0.00379662549122131).*x1.^4.*y1.^3 +
               (-0.00219018959183556).*x1.^4.*y1.^4 +
                (0.00164280993888601).*x1.^4.*y1.^5 +
                (0.00106364047467776).*x1.^4.*y1.^6 +
                (-3.46897116400914e-05).*x1.^4.*y1.^7 +
                (0.00261428534050651).*x1.^3.*y1.^1 +
                (-0.00340704470230764).*x1.^3.*y1.^2 +
                (-0.00431959089300383).*x1.^3.*y1.^3 +
                (0.004270466576964).*x1.^3.*y1.^4 +
                (0.00409709459963298).*x1.^3.*y1.^5 +
                (-0.00102132259059102).*x1.^3.*y1.^6 +
                (-0.00114708926095014).*x1.^3.*y1.^7 +
                (-9.99663705953223e-05).*x1.^3.*y1.^8 +
                (0.00180198462867549).*x1.^2.*y1.^1 +
                (-0.00168869775554094).*x1.^2.*y1.^2 +
                (0.00374499860846725).*x1.^2.*y1.^3 +
                (0.00613394294955581).*x1.^2.*y1.^4 +
                (-0.00236844954704366).*x1.^2.*y1.^5 +
                (-0.00379427819361451).*x1.^2.*y1.^6 +
                (0.000470331100806254).*x1.^2.*y1.^7 +
                (0.000688938947068089).*x1.^2.*y1.^8 +
                (0.00834461401542405).*x1.^1.*y1.^1 +
                (0.00545577299602364).*x1.^1.*y1.^2 +
                (0.00372337046173214).*x1.^1.*y1.^3 +
                (-0.00178495242496634).*x1.^1.*y1.^4 +
                (-0.00171135536320274).*x1.^1.*y1.^5 +
                (0.00118588644837419).*x1.^1.*y1.^6 +
                (0.000644998823851516).*x1.^1.*y1.^7 +
                (-7.83183304358888e-05).*x1.^1.*y1.^8);

        T := saturationTemperature(p)*(1 - (s_bubble - s)/ds) + T1*(s_bubble - s)/ds;
      elseif s > s_dew then //SH+smooth
        x2 :=(log(p) - 14.318501326731946) / (0.828373286397511);
        y2 :=(s - 3.078745756126676e+03) / (4.985098646537616e+02);
        T2 := 4.514567959585206e+02 + 93.462374188837520 *
        (-0.0708789791814325 + (0.367344112173224).*x2.^1 + (0.0186506581958736).*x2.^2
         + (0.00318899964669977).*x2.^3 + (0.000282547216289501).*x2.^4 +
         (0.00048257943328371).*x2.^5 + (0.000207212968165932).*x2.^6 +
         (-0.00011204549955888).*x2.^7 + (-9.37532514875432e-05).*x2.^8 +
         (-2.21859848344187e-05).*x2.^9 + (-1.78713841100843e-06).*x2.^10 +
          (0.97998714093717).*y2.^1 + (0.0386089222118281).*y2.^2 +
          (-0.0106585516545686).*y2.^3 + (0.00772902980120626).*y2.^4 +
          (0.00416990875506986).*y2.^5 + (-0.00475638838258409).*y2.^6 +
          (-0.00274575690445518).*y2.^7 + (0.00230101477849377).*y2.^8 +
          (0.000399323349319408).*y2.^9 + (-0.000327918311504147).*y2.^10 +
          (5.86089845545948e-06).*x2.^9.*y2.^1 + (6.71148372390456e-05).*x2.^8.*y2.^1
           + (-1.31112550105755e-05).*x2.^8.*y2.^2 + (0.000247682806790645).*x2.^7.*y2.^1
            + (-0.000136195976516863).*x2.^7.*y2.^2 + (2.3871645866491e-05).*x2.^7.*y2.^3
             + (0.00017616387019545).*x2.^6.*y2.^1 +
              (-0.000417154091956214).*x2.^6.*y2.^2 +
              (0.000220714180360342).*x2.^6.*y2.^3 +
              (-3.81215880969989e-05).*x2.^6.*y2.^4 +
              (-0.000735687508573633).*x2.^5.*y2.^1 +
              (-2.76790494582083e-05).*x2.^5.*y2.^2 +
              (0.000533886747710054).*x2.^5.*y2.^3 +
               (-0.000293837270968734).*x2.^5.*y2.^4 +
               (4.53485017787078e-05).*x2.^5.*y2.^5 +
               (-0.00112104861670486).*x2.^4.*y2.^1 +
               (0.00153853546134664).*x2.^4.*y2.^2 +
                (-0.000375926035064792).*x2.^4.*y2.^3 +
                (-0.000434206090275352).*x2.^4.*y2.^4 +
                (0.00030063485655704).*x2.^4.*y2.^5 +
                (-6.1841693279203e-05).*x2.^4.*y2.^6 +
                (-0.000959207010895185).*x2.^3.*y2.^1 +
                (0.00140884465599109).*x2.^3.*y2.^2 +
                (-0.00221804089648952).*x2.^3.*y2.^3 +
                (0.000981059478332076).*x2.^3.*y2.^4 +
                (0.000255273394929837).*x2.^3.*y2.^5 +
                (-0.000247778476130309).*x2.^3.*y2.^6 +
                (3.11728827474846e-05).*x2.^3.*y2.^7 +
                (-0.00766505741740397).*x2.^2.*y2.^1 +
                (0.00265733435406909).*x2.^2.*y2.^2 +
                (-0.00155572960179254).*x2.^2.*y2.^3 +
                (0.0016900398616944).*x2.^2.*y2.^4 +
                (-0.00111245201052813).*x2.^2.*y2.^5 +
                (0.000312430869779947).*x2.^2.*y2.^6 +
                (6.64513314960078e-05).*x2.^2.*y2.^7 +
                (-4.63505461261904e-05).*x2.^2.*y2.^8 +
                (-0.0131732391690461).*x2.^1.*y2.^1 +
                 (0.0130047445328901).*x2.^1.*y2.^2 +
                 (-0.00376724817530576).*x2.^1.*y2.^3 +
                 (7.310764241185e-05).*x2.^1.*y2.^4 +
                 (-5.23162970709533e-05).*x2.^1.*y2.^5 +
                 (0.000938157703231561).*x2.^1.*y2.^6 +
                 (-0.000584332452006185).*x2.^1.*y2.^7 +
                 (5.44118357554665e-05).*x2.^1.*y2.^8 +
                 (2.09307877783523e-05).*x2.^1.*y2.^9);

        T := saturationTemperature(p)*(1 - (s - s_dew)/ds) + T2*(s - s_dew)/ ds;
      else
        T := saturationTemperature(p);
      end if;
    elseif s > s_scr then //SCr
      x3 :=(log(p) - 15.532862129851294) / (0.142779720953699);
      y3 :=(s - 2.867381298444032e+03) / (5.754406745273917e+02);
      T := 4.802460670250321e+02 + 85.118105694639310 *
      (-0.186444671822285 + (0.0897313837606041).*x3.^1 + (0.00123457697525323).*x3.^2
       + (1.7149642101418e-05).*x3.^3 + (-5.18228670546712e-06).*x3.^4 +
       (-1.46099835557543e-05).*x3.^5 + (1.03078866720635e-06).*x3.^6 +
        (1.36233925700373e-05).*x3.^7 + (-2.66780133270429e-06).*x3.^8 +
        (-2.87031360371292e-06).*x3.^9 + (-5.46056110256994e-08).*x3.^10 +
         (1.09482545507693).*y3.^1 + (0.149128756783764).*y3.^2 +
         (-0.0542435916057507).*y3.^3 + (0.0369050913376249).*y3.^4 +
         (-0.0407321148967106).*y3.^5 + (0.00991904639269935).*y3.^6 +
         (0.0226965745711436).*y3.^7 + (-0.0120965079309773).*y3.^8 +
          (-0.00281609500220776).*y3.^9 + (0.00194309989364202).*y3.^10 +
          (3.08106343225522e-06).*x3.^9.*y3.^1 + (4.95117525356719e-06).*x3.^8.*y3.^1
          + (-1.69233720850681e-06).*x3.^8.*y3.^2 +
          (-1.14724868383366e-05).*x3.^7.*y3.^1 +
          (3.56755744611556e-06).*x3.^7.*y3.^2 + (-4.37827180460791e-06).*x3.^7.*y3.^3
           + (-3.50132384411329e-05).*x3.^6.*y3.^1 + (5.93642114018766e-05).*x3.^6.*y3.^2
            + (5.40869173800471e-06).*x3.^6.*y3.^3 +
            (-2.12466849570927e-05).*x3.^6.*y3.^4 + (-9.14865736021257e-06).*x3.^5.*y3.^1
             + (-5.14569700547426e-05).*x3.^5.*y3.^2 +
             (6.81668486003618e-05).*x3.^5.*y3.^3 +
              (2.00470154674419e-05).*x3.^5.*y3.^4 +
              (-2.13296957327864e-05).*x3.^5.*y3.^5 +
              (6.86633593172994e-05).*x3.^4.*y3.^1 +
               (-1.38326579215589e-05).*x3.^4.*y3.^2 +
               (-2.0000152362464e-05).*x3.^4.*y3.^3 +
               (-0.000106146050258357).*x3.^4.*y3.^4 +
               (-1.11356511643953e-06).*x3.^4.*y3.^5 +
               (4.74170508927234e-05).*x3.^4.*y3.^6 +
               (0.000289867464918322).*x3.^3.*y3.^1 +
               (-0.00103675103480952).*x3.^3.*y3.^2 +
               (0.000250332745851986).*x3.^3.*y3.^3 +
               (0.0012585378263192).*x3.^3.*y3.^4 +
               (-0.000594263287950658).*x3.^3.*y3.^5 +
               (-0.000326938761472995).*x3.^3.*y3.^6 +
               (0.000168007864415933).*x3.^3.*y3.^7 +
               (-0.0015669347376528).*x3.^2.*y3.^1 +
               (0.000537716278175579).*x3.^2.*y3.^2 +
               (0.00729242521140602).*x3.^2.*y3.^3 +
               (-0.00676709420200728).*x3.^2.*y3.^4 +
               (-0.00385154267835838).*x3.^2.*y3.^5 +
               (0.00427302178014446).*x3.^2.*y3.^6 +
               (0.000563366107660186).*x3.^2.*y3.^7 +
               (-0.000724706404530144).*x3.^2.*y3.^8 +
               (-0.0158976733883323).*x3.^1.*y3.^1 +
                (0.0139344429555356).*x3.^1.*y3.^2 +
                (-0.0126575779489922).*x3.^1.*y3.^3 +
                (-0.00364918945230004).*x3.^1.*y3.^4 +
                 (0.0181651582962939).*x3.^1.*y3.^5 +
                 (-0.00848136290666814).*x3.^1.*y3.^6 +
                 (-0.0027971494565493).*x3.^1.*y3.^7 +
                 (0.00230708643377618).*x3.^1.*y3.^8 +
                 (-0.000252605392896765).*x3.^1.*y3.^9);

    elseif s < s_scr then //SC
        x1 :=(log(p) - 14.956558198193330) / (0.745141086421202);
        y1 :=(s - 7.909838086570759e+02) / (4.937245780066642e+02);
      T := 2.538593397712641e+02 + 52.627656402667306 *
        ( -0.0431022969051216 + (0.0179549192591948).*x1.^1 +
        (0.00667029172008691).*x1.^2 + (0.00215800574698055).*x1.^3 +
        (0.00010313283801039).*x1.^4 + (-0.000681105144906593).*x1.^5 +
        (-0.000113923009178591).*x1.^6 + (0.000292366941254834).*x1.^7 +
         (0.000182493953945194).*x1.^8 + (4.35626066075309e-05).*x1.^9 +
         (4.54413228418679e-06).*x1.^10 + (1.67377971230446e-07).*x1.^11 +
         (1.01369000697853).*y1.^1 + (0.0475233267067756).*y1.^2 +
         (-0.0138176331024103).*y1.^3 + (-0.00606945795313334).*y1.^4 +
         (-0.000497652432019186).*y1.^5 + (0.00185495500161636).*y1.^6 +
          (-0.000126105501159687).*y1.^7 + (-0.000455255339273504).*y1.^8 +
           (1.85406957305218e-06).*x1.^10.*y1.^1 + (1.98221008294585e-05).*x1.^9.*y1.^1
            + (-6.12796499036914e-06).*x1.^9.*y1.^2 +
            (1.08254834564334e-05).*x1.^8.*y1.^1 +
            (-0.000116056764276753).*x1.^8.*y1.^2 +
            (-8.28823578117116e-06).*x1.^8.*y1.^3 +
            (-0.00042045785286443).*x1.^7.*y1.^1 +
             (-0.00043701152278637).*x1.^7.*y1.^2 +
             (0.000216091315683604).*x1.^7.*y1.^3 +
              (9.38720952997965e-05).*x1.^7.*y1.^4 +
              (-0.00134042271964956).*x1.^6.*y1.^1 +
              (-1.05010232920484e-05).*x1.^6.*y1.^2 +
              (0.00115127202911589).*x1.^6.*y1.^3 +
              (-4.59875470589928e-05).*x1.^6.*y1.^4 +
              (-0.000233055941744266).*x1.^6.*y1.^5 +
              (-0.000557033119514029).*x1.^5.*y1.^1 +
              (0.00194058204377519).*x1.^5.*y1.^2 +
              (0.000722268449138769).*x1.^5.*y1.^3 +
              (-0.00164776647352168).*x1.^5.*y1.^4 +
              (-0.00046950710947453).*x1.^5.*y1.^5 +
              (0.000251625159197325).*x1.^5.*y1.^6 +
              (0.00248548217241555).*x1.^4.*y1.^1 +
              (0.0012085435953491).*x1.^4.*y1.^2 +
              (-0.00379662549122131).*x1.^4.*y1.^3 +
               (-0.00219018959183556).*x1.^4.*y1.^4 +
                (0.00164280993888601).*x1.^4.*y1.^5 +
                (0.00106364047467776).*x1.^4.*y1.^6 +
                (-3.46897116400914e-05).*x1.^4.*y1.^7 +
                (0.00261428534050651).*x1.^3.*y1.^1 +
                (-0.00340704470230764).*x1.^3.*y1.^2 +
                (-0.00431959089300383).*x1.^3.*y1.^3 +
                (0.004270466576964).*x1.^3.*y1.^4 +
                (0.00409709459963298).*x1.^3.*y1.^5 +
                (-0.00102132259059102).*x1.^3.*y1.^6 +
                (-0.00114708926095014).*x1.^3.*y1.^7 +
                (-9.99663705953223e-05).*x1.^3.*y1.^8 +
                (0.00180198462867549).*x1.^2.*y1.^1 +
                (-0.00168869775554094).*x1.^2.*y1.^2 +
                (0.00374499860846725).*x1.^2.*y1.^3 +
                (0.00613394294955581).*x1.^2.*y1.^4 +
                (-0.00236844954704366).*x1.^2.*y1.^5 +
                (-0.00379427819361451).*x1.^2.*y1.^6 +
                (0.000470331100806254).*x1.^2.*y1.^7 +
                (0.000688938947068089).*x1.^2.*y1.^8 +
                (0.00834461401542405).*x1.^1.*y1.^1 +
                (0.00545577299602364).*x1.^1.*y1.^2 +
                (0.00372337046173214).*x1.^1.*y1.^3 +
                (-0.00178495242496634).*x1.^1.*y1.^4 +
                (-0.00171135536320274).*x1.^1.*y1.^5 +
                (0.00118588644837419).*x1.^1.*y1.^6 +
                (0.000644998823851516).*x1.^1.*y1.^7 +
                (-7.83183304358888e-05).*x1.^1.*y1.^8);
    end if;

  annotation(derivative(noDerivative=phase)=temperature_ps_der,
          Inline=false,
          LateInline=true);
  end temperature_ps;
  //aktuell neue Einteilung eingesetzt;
  //für SH einen wird ein Fit alten Einteilung eingesetzt, nur als Test

  redeclare replaceable function density_pT
    "Computes density as a function of pressure and temperature"
    extends Modelica.Icons.Function;
    input AbsolutePressure p "Pressure";
    input Temperature T "Temperature";
    input FixedPhase phase = 0
      "2 for two-phase, 1 for one-phase, 0 if not known";
    output Density d "Density";

  protected
    SmoothTransition st;
    AbsolutePressure dp = st.d_pT;
    SaturationProperties sat = setSat_T(T=T);
    Real x1;
    Real y1;
    Real d1;
    Real x2;
    Real y2;
    Real d2;
    Real x3;
    Real y3;
    Real x4;
    Real y4;
    Real x5;
    Real y5;
    Real x6;
    Real y6;
    Real fitSCrSH;
    Real fitSCrSC;
    Real x_SCrSH;
    Real x_SCrSC;

  algorithm

    if T<3.619000000000000e+02 then
       fitSCrSH :=999E5;
       fitSCrSC :=0;
    elseif T > 367.05 then
      fitSCrSC := 999E5;
    elseif T > 420 then
       fitSCrSH :=999E5;

     else
      x_SCrSH :=(T - 3.751389867841397e+02)/6.748817289272371;

      fitSCrSH := 4484000 + 4.588491037367295e+05 *
      (0.0152099087177519.*x_SCrSH.^8 + 0.0463204958934176.*x_SCrSH.^7 +
      (-0.00821530680598445).*x_SCrSH.^6 + (-0.111485565220064).*x_SCrSH.^5 +
      (-0.0207606986194443).*x_SCrSH.^4 + 0.11065868066262.*x_SCrSH.^3 +
      0.118926232873641.*x_SCrSH.^2 + 0.943487883922349.*x_SCrSH + (-0.11790565496121));

      x_SCrSC :=(T - 3.700391126494653e+02)/5.414482959937001;

      fitSCrSC := 4484000 + 4.588491037367295e+05 *
      (0.00177369986526624.*x_SCrSC.^8 + (-0.00158262772812417).*x_SCrSC.^7 +
      (-0.0116007964663472).*x_SCrSC.^6 + 0.000664985388183813.*x_SCrSC.^5 +
      0.0151412218296703.*x_SCrSC.^4 + (-0.00921077928057059).*x_SCrSC.^3 +
      (-0.101439322241044).*x_SCrSC.^2 + 1.10712944376357.*x_SCrSC + 0.123720230942727);

    end if;

       if p < 3.691838925844686e+06 then //SC, SH, SC+smooth or SH+smooth
         if p < sat.psat - dp then //SH
           x1 :=(p - 2.980358857267919e+06)/2.003389387197036e+06;
           y1 :=(T - 4.054229562317557e+02)/45.958409114606440;

           d := 56.635211776407670 + 51.170196305935875 *
           (-0.155405407061141 + (0.858952978344348).*x1.^1 + (0.213288291210149).*x1.^2
           + (-0.0902939804954138).*x1.^3 + (-0.0775446256383539).*x1.^4 +
           (0.176073913408194).*x1.^5 + (0.076632784026947).*x1.^6 +
            (-0.0754392352663131).*x1.^7 + (-0.0168165605990865).*x1.^8 +
            (0.0119196239259754).*x1.^9 + (-0.24679776490568).*y1.^1 +
            (0.118452496083566).*y1.^2 + (0.058010861375621).*y1.^3 +
            (-0.125721755741676).*y1.^4 + (-0.0869548090944236).*y1.^5 +
            (0.151426848923125).*y1.^6 + (-0.00345027146128307).*y1.^7 +
            (-0.0380867550273735).*y1.^8 + (0.00770302229640823).*y1.^9 +
            (-0.000184356030018773).*y1.^10 + (0.00695003004458847).*y1.^9.*x1.^1 +
            (-0.10233644571842).*y1.^8.*x1.^1 + (-0.0574618220752893).*y1.^8.*x1.^2 +
            (0.205712953312401).*y1.^7.*x1.^1 + (0.387270894204892).*y1.^7.*x1.^2 +
             (0.172714228770193).*y1.^7.*x1.^3 + (0.237231827455007).*y1.^6.*x1.^1
             + (-0.381261125587045).*y1.^6.*x1.^2 + (-0.688016470590964).*y1.^6.*x1.^3
             + (-0.244367687983105).*y1.^6.*x1.^4 + (-0.807515143414528).*y1.^5.*x1.^1
             + (-0.963615374256844).*y1.^5.*x1.^2 + (0.345738162507936).*y1.^5.*x1.^3 +
              (0.76365527515375).*y1.^5.*x1.^4 + (0.203962115703852).*y1.^5.*x1.^5 +
              (0.260045573530793).*y1.^4.*x1.^1 + (1.72973599259557).*y1.^4.*x1.^2 +
              (1.46553662256924).*y1.^4.*x1.^3 + (-0.350716651246153).*y1.^4.*x1.^4 +
              (-0.598601071183006).*y1.^4.*x1.^5 + (-0.0998971840299521).*y1.^4.*x1.^6 +
               (0.445273288860043).*y1.^3.*x1.^1 + (-0.38718966280931).*y1.^3.*x1.^2 +
               (-2.07977216412435).*y1.^3.*x1.^3 + (-1.06940284008784).*y1.^3.*x1.^4 +
               (0.5303829417672).*y1.^3.*x1.^5 + (0.324669022252792).*y1.^3.*x1.^6 +
               (-0.0084090709705604).*y1.^3.*x1.^7 + (-0.0816405819198117).*y1.^2.*x1.^1 +
               (-0.53432536208958).*y1.^2.*x1.^2 + (0.555479825486614).*y1.^2.*x1.^3 +
                (1.45239969441888).*y1.^2.*x1.^4 + (0.229206711193164).*y1.^2.*x1.^5 +
                 (-0.450986392763636).*y1.^2.*x1.^6 + (-0.0771458804542199).*y1.^2.*x1.^7 +
                  (0.0377378900218081).*y1.^2.*x1.^8 + (-0.416239624689007).*y1.^1.*x1.^1 +
                  (0.0607974650064569).*y1.^1.*x1.^2 + (0.358387861018122).*y1.^1.*x1.^3 +
                  (-0.469572807008312).*y1.^1.*x1.^4 + (-0.579176416783071).*y1.^1.*x1.^5 +
                  (0.150532390667626).*y1.^1.*x1.^6 + (0.175128728652312).*y1.^1.*x1.^7 +
                  (-0.022779697731843).*y1.^1.*x1.^8 + (-0.0128793243342138).*y1.^1.*x1.^9);

         elseif p>sat.psat+dp then //"SC"
           x2 := (p - 4.066785093386197e+06)/1.790595204246330e+06;
           y2 := (T - 2.927309039344773e+02)/36.935791732092900;

           d := 5.021637908690308e+02 + 57.120656672831736 *
           (0.122628621825257 + (0.0731630519572219).*x2.^1 +
           (-0.00572904977770462).*x2.^2 + (-0.00136839618246502).*x2.^3 +
           (0.0040042546391541).*x2.^4 + (0.037308708605432).*x2.^5 +
           (-0.00267201148615639).*x2.^6 + (-0.0816177943174794).*x2.^7 +
            (-0.00189729734114207).*x2.^8 + (0.0761666848702064).*x2.^9 +
            (0.00449468878280426).*x2.^10 + (-0.0357714898491775).*x2.^11 +
            (-0.00294713422296106).*x2.^12 + (0.00832562400184558).*x2.^13 +
             (0.000847940973808331).*x2.^14 + (-0.000764663596284313).*x2.^15 +
             (-9.19072294667262e-05).*x2.^16 + (-0.900766249303389).*y2.^1 +
             (-0.109709886053608).*y2.^2 + (-0.0824965751813141).*y2.^3 +
             (-0.00282398160405329).*y2.^4 + (0.0404703376301376).*y2.^5 +
              (-0.00361601298379455).*y2.^6 + (-0.0109677613902719).*y2.^7 +
              (-0.000181915684599463).*x2.^15.*y2.^1 + (0.00310567085918266).*x2.^14.*y2.^1
              + (0.00179475802273201).*x2.^14.*y2.^2 + (0.00255386548103765).*x2.^13.*y2.^1
              + (-0.00517755455334563).*x2.^13.*y2.^2 + (-0.00357666025951103).*x2.^13.*y2.^3
               + (-0.0286738548956243).*x2.^12.*y2.^1 + (-0.0145379218778659).*x2.^12.*y2.^2
               + (0.00604120178647358).*x2.^12.*y2.^3 + (0.00323866669439068).*x2.^12.*y2.^4
               + (-0.0123342782624321).*x2.^11.*y2.^1 + (0.0398484682810554).*x2.^11.*y2.^2
               + (0.0215841806339639).*x2.^11.*y2.^3 + (-0.00505275583649637).*x2.^11.*y2.^4
               + (-0.00084697060309848).*x2.^11.*y2.^5 + (0.100324404564703).*x2.^10.*y2.^1
               + (0.0416510946699947).*x2.^10.*y2.^2 + (-0.0346433215549809).*x2.^10.*y2.^3
               + (-0.0104695424856429).*x2.^10.*y2.^4 + (0.00263200070596859).*x2.^10.*y2.^5
               + (-0.00108641513943855).*x2.^10.*y2.^6 + (0.0274817662361809).*x2.^9.*y2.^1 +
                (-0.105296756592505).*x2.^9.*y2.^2 + (-0.0371385674511631).*x2.^9.*y2.^3 +
                (0.0162736754821761).*x2.^9.*y2.^4 + (-0.00720135086892108).*x2.^9.*y2.^5 +
                 (-0.000399918522224775).*x2.^9.*y2.^6 + (0.000940940318133506).*x2.^9.*y2.^7 +
                  (-0.159290053048822).*x2.^8.*y2.^1 + (-0.0451759288259862).*x2.^8.*y2.^2 +
                  (0.04469686320809).*x2.^8.*y2.^3 + (-0.0157927388741425).*x2.^8.*y2.^4 +
                  (0.00421806264235319).*x2.^8.*y2.^5 + (0.0140323888355763).*x2.^8.*y2.^6 +
                  (-0.000885123372202905).*x2.^8.*y2.^7 + (-0.028804247026021).*x2.^7.*y2.^1 +
                  (0.0944377210887243).*x2.^7.*y2.^2 + (-0.00997538105125576).*x2.^7.*y2.^3 +
                  (0.0198465870688589).*x2.^7.*y2.^4 + (0.0560731875277372).*x2.^7.*y2.^5 +
                  (-0.00735497867853542).*x2.^7.*y2.^6 + (-0.00921756265221957).*x2.^7.*y2.^7 +
                  (0.0938096791624358).*x2.^6.*y2.^1 + (0.000760796172942089).*x2.^6.*y2.^2 +
                  (0.0748546068766894).*x2.^6.*y2.^3 + (0.090852284055484).*x2.^6.*y2.^4 +
                  (-0.070506846210398).*x2.^6.*y2.^5 + (-0.0428767574966193).*x2.^6.*y2.^6 +
                   (0.00949878612915431).*x2.^6.*y2.^7 + (0.008587323727443).*x2.^5.*y2.^1 +
                   (0.0311859274597602).*x2.^5.*y2.^2 + (0.0946446112119123).*x2.^5.*y2.^3 +
                   (-0.117858010954743).*x2.^5.*y2.^4 + (-0.124997635439133).*x2.^5.*y2.^5 +
                   (0.030679554871999).*x2.^5.*y2.^6 + (0.0263750408403291).*x2.^5.*y2.^7 +
                   (0.0293448518869167).*x2.^4.*y2.^1 + (0.0230972514034103).*x2.^4.*y2.^2 +
                   (-0.232307481911892).*x2.^4.*y2.^3 + (-0.102766957962802).*x2.^4.*y2.^4 +
                   (0.165226159438051).*x2.^4.*y2.^5 + (0.0468397541038271).*x2.^4.*y2.^6 +
                   (-0.027205339050262).*x2.^4.*y2.^7 + (0.00722743669214316).*x2.^3.*y2.^1 +
                   (-0.0834976239420921).*x2.^3.*y2.^2 + (-0.0947683339785946).*x2.^3.*y2.^3 +
                    (0.128266195351322).*x2.^3.*y2.^4 + (0.112677187454975).*x2.^3.*y2.^5 +
                    (-0.0353616564101556).*x2.^3.*y2.^6 + (-0.0281203381521887).*x2.^3.*y2.^7 +
                    (-0.0577321476805478).*x2.^2.*y2.^1 + (-0.00529917338841401).*x2.^2.*y2.^2 +
                     (0.191914708599173).*x2.^2.*y2.^3 + (0.0282683906371302).*x2.^2.*y2.^4 +
                     (-0.147285981576142).*x2.^2.*y2.^5 + (-0.0173425133065822).*x2.^2.*y2.^6 +
                      (0.0283303265421487).*x2.^2.*y2.^7 + (0.0432160349546858).*x2.^1.*y2.^1 +
                      (0.0514986198028016).*x2.^1.*y2.^2 + (0.0355856091333069).*x2.^1.*y2.^3 +
                       (-0.036817044774667).*x2.^1.*y2.^4 + (-0.0284525605002739).*x2.^1.*y2.^5 +
                       (0.0156065386330833).*x2.^1.*y2.^6 + (0.010189574114693).*x2.^1.*y2.^7);

         elseif p<sat.psat then //"SH + smooth"

           x1 :=(p - 2.980358857267919e+06)/2.003389387197036e+06;
           y1 :=(T - 4.054229562317557e+02)/45.958409114606440;

           d1 := 56.635211776407670 + 51.170196305935875 *
           (-0.155405407061141 + (0.858952978344348).*x1.^1 + (0.213288291210149).*x1.^2
           + (-0.0902939804954138).*x1.^3 + (-0.0775446256383539).*x1.^4 +
           (0.176073913408194).*x1.^5 + (0.076632784026947).*x1.^6 +
            (-0.0754392352663131).*x1.^7 + (-0.0168165605990865).*x1.^8 +
            (0.0119196239259754).*x1.^9 + (-0.24679776490568).*y1.^1 +
            (0.118452496083566).*y1.^2 + (0.058010861375621).*y1.^3 +
            (-0.125721755741676).*y1.^4 + (-0.0869548090944236).*y1.^5 +
            (0.151426848923125).*y1.^6 + (-0.00345027146128307).*y1.^7 +
            (-0.0380867550273735).*y1.^8 + (0.00770302229640823).*y1.^9 +
            (-0.000184356030018773).*y1.^10 + (0.00695003004458847).*y1.^9.*x1.^1 +
            (-0.10233644571842).*y1.^8.*x1.^1 + (-0.0574618220752893).*y1.^8.*x1.^2 +
            (0.205712953312401).*y1.^7.*x1.^1 + (0.387270894204892).*y1.^7.*x1.^2 +
             (0.172714228770193).*y1.^7.*x1.^3 + (0.237231827455007).*y1.^6.*x1.^1
             + (-0.381261125587045).*y1.^6.*x1.^2 + (-0.688016470590964).*y1.^6.*x1.^3
             + (-0.244367687983105).*y1.^6.*x1.^4 + (-0.807515143414528).*y1.^5.*x1.^1
             + (-0.963615374256844).*y1.^5.*x1.^2 + (0.345738162507936).*y1.^5.*x1.^3 +
              (0.76365527515375).*y1.^5.*x1.^4 + (0.203962115703852).*y1.^5.*x1.^5 +
              (0.260045573530793).*y1.^4.*x1.^1 + (1.72973599259557).*y1.^4.*x1.^2 +
              (1.46553662256924).*y1.^4.*x1.^3 + (-0.350716651246153).*y1.^4.*x1.^4 +
              (-0.598601071183006).*y1.^4.*x1.^5 + (-0.0998971840299521).*y1.^4.*x1.^6 +
               (0.445273288860043).*y1.^3.*x1.^1 + (-0.38718966280931).*y1.^3.*x1.^2 +
               (-2.07977216412435).*y1.^3.*x1.^3 + (-1.06940284008784).*y1.^3.*x1.^4 +
               (0.5303829417672).*y1.^3.*x1.^5 + (0.324669022252792).*y1.^3.*x1.^6 +
               (-0.0084090709705604).*y1.^3.*x1.^7 + (-0.0816405819198117).*y1.^2.*x1.^1 +
               (-0.53432536208958).*y1.^2.*x1.^2 + (0.555479825486614).*y1.^2.*x1.^3 +
                (1.45239969441888).*y1.^2.*x1.^4 + (0.229206711193164).*y1.^2.*x1.^5 +
                 (-0.450986392763636).*y1.^2.*x1.^6 + (-0.0771458804542199).*y1.^2.*x1.^7 +
                  (0.0377378900218081).*y1.^2.*x1.^8 + (-0.416239624689007).*y1.^1.*x1.^1 +
                  (0.0607974650064569).*y1.^1.*x1.^2 + (0.358387861018122).*y1.^1.*x1.^3 +
                  (-0.469572807008312).*y1.^1.*x1.^4 + (-0.579176416783071).*y1.^1.*x1.^5 +
                  (0.150532390667626).*y1.^1.*x1.^6 + (0.175128728652312).*y1.^1.*x1.^7 +
                  (-0.022779697731843).*y1.^1.*x1.^8 + (-0.0128793243342138).*y1.^1.*x1.^9);

           d := bubbleDensity(sat)*(1 -(sat.psat - p)/dp) + d1*(sat.psat - p)/dp;

         elseif p > sat.psat then //SC+smooth
           x2 := (p - 4.066785093386197e+06)/1.790595204246330e+06;
           y2 := (T - 2.927309039344773e+02)/36.935791732092900;

           d2 := 5.021637908690308e+02 + 57.120656672831736 *
           (0.122628621825257 + (0.0731630519572219).*x2.^1 +
           (-0.00572904977770462).*x2.^2 + (-0.00136839618246502).*x2.^3 +
           (0.0040042546391541).*x2.^4 + (0.037308708605432).*x2.^5 +
           (-0.00267201148615639).*x2.^6 + (-0.0816177943174794).*x2.^7 +
            (-0.00189729734114207).*x2.^8 + (0.0761666848702064).*x2.^9 +
            (0.00449468878280426).*x2.^10 + (-0.0357714898491775).*x2.^11 +
            (-0.00294713422296106).*x2.^12 + (0.00832562400184558).*x2.^13 +
             (0.000847940973808331).*x2.^14 + (-0.000764663596284313).*x2.^15 +
             (-9.19072294667262e-05).*x2.^16 + (-0.900766249303389).*y2.^1 +
             (-0.109709886053608).*y2.^2 + (-0.0824965751813141).*y2.^3 +
             (-0.00282398160405329).*y2.^4 + (0.0404703376301376).*y2.^5 +
              (-0.00361601298379455).*y2.^6 + (-0.0109677613902719).*y2.^7 +
              (-0.000181915684599463).*x2.^15.*y2.^1 + (0.00310567085918266).*x2.^14.*y2.^1
              + (0.00179475802273201).*x2.^14.*y2.^2 + (0.00255386548103765).*x2.^13.*y2.^1
              + (-0.00517755455334563).*x2.^13.*y2.^2 + (-0.00357666025951103).*x2.^13.*y2.^3
               + (-0.0286738548956243).*x2.^12.*y2.^1 + (-0.0145379218778659).*x2.^12.*y2.^2
               + (0.00604120178647358).*x2.^12.*y2.^3 + (0.00323866669439068).*x2.^12.*y2.^4
               + (-0.0123342782624321).*x2.^11.*y2.^1 + (0.0398484682810554).*x2.^11.*y2.^2
               + (0.0215841806339639).*x2.^11.*y2.^3 + (-0.00505275583649637).*x2.^11.*y2.^4
               + (-0.00084697060309848).*x2.^11.*y2.^5 + (0.100324404564703).*x2.^10.*y2.^1
               + (0.0416510946699947).*x2.^10.*y2.^2 + (-0.0346433215549809).*x2.^10.*y2.^3
               + (-0.0104695424856429).*x2.^10.*y2.^4 + (0.00263200070596859).*x2.^10.*y2.^5
               + (-0.00108641513943855).*x2.^10.*y2.^6 + (0.0274817662361809).*x2.^9.*y2.^1 +
                (-0.105296756592505).*x2.^9.*y2.^2 + (-0.0371385674511631).*x2.^9.*y2.^3 +
                (0.0162736754821761).*x2.^9.*y2.^4 + (-0.00720135086892108).*x2.^9.*y2.^5 +
                 (-0.000399918522224775).*x2.^9.*y2.^6 + (0.000940940318133506).*x2.^9.*y2.^7 +
                  (-0.159290053048822).*x2.^8.*y2.^1 + (-0.0451759288259862).*x2.^8.*y2.^2 +
                  (0.04469686320809).*x2.^8.*y2.^3 + (-0.0157927388741425).*x2.^8.*y2.^4 +
                  (0.00421806264235319).*x2.^8.*y2.^5 + (0.0140323888355763).*x2.^8.*y2.^6 +
                  (-0.000885123372202905).*x2.^8.*y2.^7 + (-0.028804247026021).*x2.^7.*y2.^1 +
                  (0.0944377210887243).*x2.^7.*y2.^2 + (-0.00997538105125576).*x2.^7.*y2.^3 +
                  (0.0198465870688589).*x2.^7.*y2.^4 + (0.0560731875277372).*x2.^7.*y2.^5 +
                  (-0.00735497867853542).*x2.^7.*y2.^6 + (-0.00921756265221957).*x2.^7.*y2.^7 +
                  (0.0938096791624358).*x2.^6.*y2.^1 + (0.000760796172942089).*x2.^6.*y2.^2 +
                  (0.0748546068766894).*x2.^6.*y2.^3 + (0.090852284055484).*x2.^6.*y2.^4 +
                  (-0.070506846210398).*x2.^6.*y2.^5 + (-0.0428767574966193).*x2.^6.*y2.^6 +
                   (0.00949878612915431).*x2.^6.*y2.^7 + (0.008587323727443).*x2.^5.*y2.^1 +
                   (0.0311859274597602).*x2.^5.*y2.^2 + (0.0946446112119123).*x2.^5.*y2.^3 +
                   (-0.117858010954743).*x2.^5.*y2.^4 + (-0.124997635439133).*x2.^5.*y2.^5 +
                   (0.030679554871999).*x2.^5.*y2.^6 + (0.0263750408403291).*x2.^5.*y2.^7 +
                   (0.0293448518869167).*x2.^4.*y2.^1 + (0.0230972514034103).*x2.^4.*y2.^2 +
                   (-0.232307481911892).*x2.^4.*y2.^3 + (-0.102766957962802).*x2.^4.*y2.^4 +
                   (0.165226159438051).*x2.^4.*y2.^5 + (0.0468397541038271).*x2.^4.*y2.^6 +
                   (-0.027205339050262).*x2.^4.*y2.^7 + (0.00722743669214316).*x2.^3.*y2.^1 +
                   (-0.0834976239420921).*x2.^3.*y2.^2 + (-0.0947683339785946).*x2.^3.*y2.^3 +
                    (0.128266195351322).*x2.^3.*y2.^4 + (0.112677187454975).*x2.^3.*y2.^5 +
                    (-0.0353616564101556).*x2.^3.*y2.^6 + (-0.0281203381521887).*x2.^3.*y2.^7 +
                    (-0.0577321476805478).*x2.^2.*y2.^1 + (-0.00529917338841401).*x2.^2.*y2.^2 +
                     (0.191914708599173).*x2.^2.*y2.^3 + (0.0282683906371302).*x2.^2.*y2.^4 +
                     (-0.147285981576142).*x2.^2.*y2.^5 + (-0.0173425133065822).*x2.^2.*y2.^6 +
                      (0.0283303265421487).*x2.^2.*y2.^7 + (0.0432160349546858).*x2.^1.*y2.^1 +
                      (0.0514986198028016).*x2.^1.*y2.^2 + (0.0355856091333069).*x2.^1.*y2.^3 +
                       (-0.036817044774667).*x2.^1.*y2.^4 + (-0.0284525605002739).*x2.^1.*y2.^5 +
                       (0.0156065386330833).*x2.^1.*y2.^6 + (0.010189574114693).*x2.^1.*y2.^7);

           d := dewDensity(sat)*(1 -(p - sat.psat)/dp) + d2*(p - sat.psat)/dp;

         end if;

       elseif p < 4251200 then //SC,SH,Tra1 or Tra2
         if p > sat.psat then //SC or Tra1
           if p > fitSCrSC then //SC
             x2 := (p - 4.066785093386197e+06)/1.790595204246330e+06;
             y2 := (T - 2.927309039344773e+02)/36.935791732092900;

             d := 5.021637908690308e+02 + 57.120656672831736 *
           (0.122628621825257 + (0.0731630519572219).*x2.^1 +
           (-0.00572904977770462).*x2.^2 + (-0.00136839618246502).*x2.^3 +
           (0.0040042546391541).*x2.^4 + (0.037308708605432).*x2.^5 +
           (-0.00267201148615639).*x2.^6 + (-0.0816177943174794).*x2.^7 +
            (-0.00189729734114207).*x2.^8 + (0.0761666848702064).*x2.^9 +
            (0.00449468878280426).*x2.^10 + (-0.0357714898491775).*x2.^11 +
            (-0.00294713422296106).*x2.^12 + (0.00832562400184558).*x2.^13 +
             (0.000847940973808331).*x2.^14 + (-0.000764663596284313).*x2.^15 +
             (-9.19072294667262e-05).*x2.^16 + (-0.900766249303389).*y2.^1 +
             (-0.109709886053608).*y2.^2 + (-0.0824965751813141).*y2.^3 +
             (-0.00282398160405329).*y2.^4 + (0.0404703376301376).*y2.^5 +
              (-0.00361601298379455).*y2.^6 + (-0.0109677613902719).*y2.^7 +
              (-0.000181915684599463).*x2.^15.*y2.^1 + (0.00310567085918266).*x2.^14.*y2.^1
              + (0.00179475802273201).*x2.^14.*y2.^2 + (0.00255386548103765).*x2.^13.*y2.^1
              + (-0.00517755455334563).*x2.^13.*y2.^2 + (-0.00357666025951103).*x2.^13.*y2.^3
               + (-0.0286738548956243).*x2.^12.*y2.^1 + (-0.0145379218778659).*x2.^12.*y2.^2
               + (0.00604120178647358).*x2.^12.*y2.^3 + (0.00323866669439068).*x2.^12.*y2.^4
               + (-0.0123342782624321).*x2.^11.*y2.^1 + (0.0398484682810554).*x2.^11.*y2.^2
               + (0.0215841806339639).*x2.^11.*y2.^3 + (-0.00505275583649637).*x2.^11.*y2.^4
               + (-0.00084697060309848).*x2.^11.*y2.^5 + (0.100324404564703).*x2.^10.*y2.^1
               + (0.0416510946699947).*x2.^10.*y2.^2 + (-0.0346433215549809).*x2.^10.*y2.^3
               + (-0.0104695424856429).*x2.^10.*y2.^4 + (0.00263200070596859).*x2.^10.*y2.^5
               + (-0.00108641513943855).*x2.^10.*y2.^6 + (0.0274817662361809).*x2.^9.*y2.^1 +
                (-0.105296756592505).*x2.^9.*y2.^2 + (-0.0371385674511631).*x2.^9.*y2.^3 +
                (0.0162736754821761).*x2.^9.*y2.^4 + (-0.00720135086892108).*x2.^9.*y2.^5 +
                 (-0.000399918522224775).*x2.^9.*y2.^6 + (0.000940940318133506).*x2.^9.*y2.^7 +
                  (-0.159290053048822).*x2.^8.*y2.^1 + (-0.0451759288259862).*x2.^8.*y2.^2 +
                  (0.04469686320809).*x2.^8.*y2.^3 + (-0.0157927388741425).*x2.^8.*y2.^4 +
                  (0.00421806264235319).*x2.^8.*y2.^5 + (0.0140323888355763).*x2.^8.*y2.^6 +
                  (-0.000885123372202905).*x2.^8.*y2.^7 + (-0.028804247026021).*x2.^7.*y2.^1 +
                  (0.0944377210887243).*x2.^7.*y2.^2 + (-0.00997538105125576).*x2.^7.*y2.^3 +
                  (0.0198465870688589).*x2.^7.*y2.^4 + (0.0560731875277372).*x2.^7.*y2.^5 +
                  (-0.00735497867853542).*x2.^7.*y2.^6 + (-0.00921756265221957).*x2.^7.*y2.^7 +
                  (0.0938096791624358).*x2.^6.*y2.^1 + (0.000760796172942089).*x2.^6.*y2.^2 +
                  (0.0748546068766894).*x2.^6.*y2.^3 + (0.090852284055484).*x2.^6.*y2.^4 +
                  (-0.070506846210398).*x2.^6.*y2.^5 + (-0.0428767574966193).*x2.^6.*y2.^6 +
                   (0.00949878612915431).*x2.^6.*y2.^7 + (0.008587323727443).*x2.^5.*y2.^1 +
                   (0.0311859274597602).*x2.^5.*y2.^2 + (0.0946446112119123).*x2.^5.*y2.^3 +
                   (-0.117858010954743).*x2.^5.*y2.^4 + (-0.124997635439133).*x2.^5.*y2.^5 +
                   (0.030679554871999).*x2.^5.*y2.^6 + (0.0263750408403291).*x2.^5.*y2.^7 +
                   (0.0293448518869167).*x2.^4.*y2.^1 + (0.0230972514034103).*x2.^4.*y2.^2 +
                   (-0.232307481911892).*x2.^4.*y2.^3 + (-0.102766957962802).*x2.^4.*y2.^4 +
                   (0.165226159438051).*x2.^4.*y2.^5 + (0.0468397541038271).*x2.^4.*y2.^6 +
                   (-0.027205339050262).*x2.^4.*y2.^7 + (0.00722743669214316).*x2.^3.*y2.^1 +
                   (-0.0834976239420921).*x2.^3.*y2.^2 + (-0.0947683339785946).*x2.^3.*y2.^3 +
                    (0.128266195351322).*x2.^3.*y2.^4 + (0.112677187454975).*x2.^3.*y2.^5 +
                    (-0.0353616564101556).*x2.^3.*y2.^6 + (-0.0281203381521887).*x2.^3.*y2.^7 +
                    (-0.0577321476805478).*x2.^2.*y2.^1 + (-0.00529917338841401).*x2.^2.*y2.^2 +
                     (0.191914708599173).*x2.^2.*y2.^3 + (0.0282683906371302).*x2.^2.*y2.^4 +
                     (-0.147285981576142).*x2.^2.*y2.^5 + (-0.0173425133065822).*x2.^2.*y2.^6 +
                      (0.0283303265421487).*x2.^2.*y2.^7 + (0.0432160349546858).*x2.^1.*y2.^1 +
                      (0.0514986198028016).*x2.^1.*y2.^2 + (0.0355856091333069).*x2.^1.*y2.^3 +
                       (-0.036817044774667).*x2.^1.*y2.^4 + (-0.0284525605002739).*x2.^1.*y2.^5 +
                       (0.0156065386330833).*x2.^1.*y2.^6 + (0.010189574114693).*x2.^1.*y2.^7);

           else //Tra1
            x3 :=(p - 4.046574025405169e+06)/1.402633726495369e+05;
            y3 :=(T - 3.661336837494544e+02)/1.732142136607601;

            d := 3.151848490617844e+02 + 13.306001092621717 *
            (0.127815138137562 + (1.02935294033132).*x3.^1 +
            (-0.472372293008672).*x3.^2 + (0.113578162000697).*x3.^3 +
            (0.675637088122515).*x3.^4 + (0.397265709267311).*x3.^5 +
            (-1.38539097475844).*x3.^6 + (-1.72201460263383).*y3.^1 +
            (-0.8145413828302).*y3.^2 + (-0.474608422846044).*y3.^3 +
            (1.27934859052167).*y3.^4 + (-0.104300453887235).*y3.^5 +
            (-3.5425989935909).*y3.^6 + (9.54018152927358).*x3.^5.*y3.^1 +
            (-1.8557040294129).*x3.^4.*y3.^1 + (-27.5935372972019).*x3.^4.*y3.^2 +
             (-3.14494764264872).*x3.^3.*y3.^1 + (3.35197729072041).*x3.^3.*y3.^2 +
              (42.8949112755435).*x3.^3.*y3.^3 + (-0.619421207452818).*x3.^2.*y3.^1 +
               (5.5131777119992).*x3.^2.*y3.^2 + (-2.84382234199477).*x3.^2.*y3.^3 +
               (-37.7824415348544).*x3.^2.*y3.^4 + (1.25182712001432).*x3.^1.*y3.^1 +
               (0.975391900928452).*x3.^1.*y3.^2 + (-4.32107618487671).*x3.^1.*y3.^3 +
               (1.05552797545557).*x3.^1.*y3.^4 + (17.8687581252318).*x3.^1.*y3.^5);

           end if;
         elseif p < sat.psat then //SH or Tra2
           if p < fitSCrSH then //SH

           x1 :=(p - 2.980358857267919e+06)/2.003389387197036e+06;
           y1 :=(T - 4.054229562317557e+02)/45.958409114606440;

           d := 56.635211776407670 + 51.170196305935875 *
           (-0.155405407061141 + (0.858952978344348).*x1.^1 + (0.213288291210149).*x1.^2
           + (-0.0902939804954138).*x1.^3 + (-0.0775446256383539).*x1.^4 +
           (0.176073913408194).*x1.^5 + (0.076632784026947).*x1.^6 +
            (-0.0754392352663131).*x1.^7 + (-0.0168165605990865).*x1.^8 +
            (0.0119196239259754).*x1.^9 + (-0.24679776490568).*y1.^1 +
            (0.118452496083566).*y1.^2 + (0.058010861375621).*y1.^3 +
            (-0.125721755741676).*y1.^4 + (-0.0869548090944236).*y1.^5 +
            (0.151426848923125).*y1.^6 + (-0.00345027146128307).*y1.^7 +
            (-0.0380867550273735).*y1.^8 + (0.00770302229640823).*y1.^9 +
            (-0.000184356030018773).*y1.^10 + (0.00695003004458847).*y1.^9.*x1.^1 +
            (-0.10233644571842).*y1.^8.*x1.^1 + (-0.0574618220752893).*y1.^8.*x1.^2 +
            (0.205712953312401).*y1.^7.*x1.^1 + (0.387270894204892).*y1.^7.*x1.^2 +
             (0.172714228770193).*y1.^7.*x1.^3 + (0.237231827455007).*y1.^6.*x1.^1
             + (-0.381261125587045).*y1.^6.*x1.^2 + (-0.688016470590964).*y1.^6.*x1.^3
             + (-0.244367687983105).*y1.^6.*x1.^4 + (-0.807515143414528).*y1.^5.*x1.^1
             + (-0.963615374256844).*y1.^5.*x1.^2 + (0.345738162507936).*y1.^5.*x1.^3 +
              (0.76365527515375).*y1.^5.*x1.^4 + (0.203962115703852).*y1.^5.*x1.^5 +
              (0.260045573530793).*y1.^4.*x1.^1 + (1.72973599259557).*y1.^4.*x1.^2 +
              (1.46553662256924).*y1.^4.*x1.^3 + (-0.350716651246153).*y1.^4.*x1.^4 +
              (-0.598601071183006).*y1.^4.*x1.^5 + (-0.0998971840299521).*y1.^4.*x1.^6 +
               (0.445273288860043).*y1.^3.*x1.^1 + (-0.38718966280931).*y1.^3.*x1.^2 +
               (-2.07977216412435).*y1.^3.*x1.^3 + (-1.06940284008784).*y1.^3.*x1.^4 +
               (0.5303829417672).*y1.^3.*x1.^5 + (0.324669022252792).*y1.^3.*x1.^6 +
               (-0.0084090709705604).*y1.^3.*x1.^7 + (-0.0816405819198117).*y1.^2.*x1.^1 +
               (-0.53432536208958).*y1.^2.*x1.^2 + (0.555479825486614).*y1.^2.*x1.^3 +
                (1.45239969441888).*y1.^2.*x1.^4 + (0.229206711193164).*y1.^2.*x1.^5 +
                 (-0.450986392763636).*y1.^2.*x1.^6 + (-0.0771458804542199).*y1.^2.*x1.^7 +
                  (0.0377378900218081).*y1.^2.*x1.^8 + (-0.416239624689007).*y1.^1.*x1.^1 +
                  (0.0607974650064569).*y1.^1.*x1.^2 + (0.358387861018122).*y1.^1.*x1.^3 +
                  (-0.469572807008312).*y1.^1.*x1.^4 + (-0.579176416783071).*y1.^1.*x1.^5 +
                  (0.150532390667626).*y1.^1.*x1.^6 + (0.175128728652312).*y1.^1.*x1.^7 +
                  (-0.022779697731843).*y1.^1.*x1.^8 + (-0.0128793243342138).*y1.^1.*x1.^9);

           else //Tra2
            x4 :=(p - 4.070794245049505e+06)/1.262754225385592e+05;
            y4 :=(T - 3.683481745049519e+02)/2.044093791238606;

            d := 1.362233447731684e+02 + 10.666495162261237 *
            (-0.0834487005554086 + (2.6557647375711).*x4.^1 +
            (1.4993731616571).*x4.^2 + (1.24645339427198).*x4.^3 +
            (1.75684334219376).*x4.^4 + (3.17277647913325).*x4.^5 +
            (2.92873121286135).*x4.^6 + (4.18486701402988).*x4.^7 +
            (3.61679551985185).*x4.^8 + (-2.00084423938165).*y4.^1 +
            (1.25600444045981).*y4.^2 + (-1.0156585271478).*y4.^3 +
            (2.27747234275931).*y4.^4 + (-5.03935373747509).*y4.^5 +
            (-0.270813475342741).*y4.^6 + (6.6503720568735).*y4.^7 +
            (-18.7294571266319).*x4.^7.*y4.^1 + (-23.9245917994471).*x4.^6.*y4.^1
            + (36.1887513810878).*x4.^6.*y4.^2 + (-17.5558257521055).*x4.^5.*y4.^1
            + (49.49036817115).*x4.^5.*y4.^2 + (-26.8835722743425).*x4.^5.*y4.^3 +
             (-17.5233346467019).*x4.^4.*y4.^1 + (41.0381209153234).*x4.^4.*y4.^2
              + (-35.8028259404329).*x4.^4.*y4.^3 + (-6.40470155448874).*x4.^4.*y4.^4
              + (-7.46845378301901).*x4.^3.*y4.^1 + (38.6703552164067).*x4.^3.*y4.^2 +
              (-46.7354099035579).*x4.^3.*y4.^3 + (-19.698899893405).*x4.^3.*y4.^4 +
              (23.6151927931333).*x4.^3.*y4.^5 + (-3.57177000406539).*x4.^2.*y4.^1 +
              (11.9185177511132).*x4.^2.*y4.^2 + (-42.5006568234138).*x4.^2.*y4.^3 +
              (25.6712092190195).*x4.^2.*y4.^4 + (50.011080400142).*x4.^2.*y4.^5 +
               (-14.366376134467).*x4.^2.*y4.^6 + (-2.78682393985674).*x4.^1.*y4.^1
                + (3.33368166228213).*x4.^1.*y4.^2 + (-8.48499222380453).*x4.^1.*y4.^3
                + (23.2201563332511).*x4.^1.*y4.^4 + (-5.07586747714745).*x4.^1.*y4.^5
                + (-30.9103040353046).*x4.^1.*y4.^6 + (2.96337429908433).*x4.^1.*y4.^7);

           end if;
         end if;

       elseif p > fitSCrSC then //SC
         x2 := (p - 4.066785093386197e+06)/1.790595204246330e+06;
         y2 := (T - 2.927309039344773e+02)/36.935791732092900;

         d := 5.021637908690308e+02 + 57.120656672831736 *
           (0.122628621825257 + (0.0731630519572219).*x2.^1 +
           (-0.00572904977770462).*x2.^2 + (-0.00136839618246502).*x2.^3 +
           (0.0040042546391541).*x2.^4 + (0.037308708605432).*x2.^5 +
           (-0.00267201148615639).*x2.^6 + (-0.0816177943174794).*x2.^7 +
            (-0.00189729734114207).*x2.^8 + (0.0761666848702064).*x2.^9 +
            (0.00449468878280426).*x2.^10 + (-0.0357714898491775).*x2.^11 +
            (-0.00294713422296106).*x2.^12 + (0.00832562400184558).*x2.^13 +
             (0.000847940973808331).*x2.^14 + (-0.000764663596284313).*x2.^15 +
             (-9.19072294667262e-05).*x2.^16 + (-0.900766249303389).*y2.^1 +
             (-0.109709886053608).*y2.^2 + (-0.0824965751813141).*y2.^3 +
             (-0.00282398160405329).*y2.^4 + (0.0404703376301376).*y2.^5 +
              (-0.00361601298379455).*y2.^6 + (-0.0109677613902719).*y2.^7 +
              (-0.000181915684599463).*x2.^15.*y2.^1 + (0.00310567085918266).*x2.^14.*y2.^1
              + (0.00179475802273201).*x2.^14.*y2.^2 + (0.00255386548103765).*x2.^13.*y2.^1
              + (-0.00517755455334563).*x2.^13.*y2.^2 + (-0.00357666025951103).*x2.^13.*y2.^3
               + (-0.0286738548956243).*x2.^12.*y2.^1 + (-0.0145379218778659).*x2.^12.*y2.^2
               + (0.00604120178647358).*x2.^12.*y2.^3 + (0.00323866669439068).*x2.^12.*y2.^4
               + (-0.0123342782624321).*x2.^11.*y2.^1 + (0.0398484682810554).*x2.^11.*y2.^2
               + (0.0215841806339639).*x2.^11.*y2.^3 + (-0.00505275583649637).*x2.^11.*y2.^4
               + (-0.00084697060309848).*x2.^11.*y2.^5 + (0.100324404564703).*x2.^10.*y2.^1
               + (0.0416510946699947).*x2.^10.*y2.^2 + (-0.0346433215549809).*x2.^10.*y2.^3
               + (-0.0104695424856429).*x2.^10.*y2.^4 + (0.00263200070596859).*x2.^10.*y2.^5
               + (-0.00108641513943855).*x2.^10.*y2.^6 + (0.0274817662361809).*x2.^9.*y2.^1 +
                (-0.105296756592505).*x2.^9.*y2.^2 + (-0.0371385674511631).*x2.^9.*y2.^3 +
                (0.0162736754821761).*x2.^9.*y2.^4 + (-0.00720135086892108).*x2.^9.*y2.^5 +
                 (-0.000399918522224775).*x2.^9.*y2.^6 + (0.000940940318133506).*x2.^9.*y2.^7 +
                  (-0.159290053048822).*x2.^8.*y2.^1 + (-0.0451759288259862).*x2.^8.*y2.^2 +
                  (0.04469686320809).*x2.^8.*y2.^3 + (-0.0157927388741425).*x2.^8.*y2.^4 +
                  (0.00421806264235319).*x2.^8.*y2.^5 + (0.0140323888355763).*x2.^8.*y2.^6 +
                  (-0.000885123372202905).*x2.^8.*y2.^7 + (-0.028804247026021).*x2.^7.*y2.^1 +
                  (0.0944377210887243).*x2.^7.*y2.^2 + (-0.00997538105125576).*x2.^7.*y2.^3 +
                  (0.0198465870688589).*x2.^7.*y2.^4 + (0.0560731875277372).*x2.^7.*y2.^5 +
                  (-0.00735497867853542).*x2.^7.*y2.^6 + (-0.00921756265221957).*x2.^7.*y2.^7 +
                  (0.0938096791624358).*x2.^6.*y2.^1 + (0.000760796172942089).*x2.^6.*y2.^2 +
                  (0.0748546068766894).*x2.^6.*y2.^3 + (0.090852284055484).*x2.^6.*y2.^4 +
                  (-0.070506846210398).*x2.^6.*y2.^5 + (-0.0428767574966193).*x2.^6.*y2.^6 +
                   (0.00949878612915431).*x2.^6.*y2.^7 + (0.008587323727443).*x2.^5.*y2.^1 +
                   (0.0311859274597602).*x2.^5.*y2.^2 + (0.0946446112119123).*x2.^5.*y2.^3 +
                   (-0.117858010954743).*x2.^5.*y2.^4 + (-0.124997635439133).*x2.^5.*y2.^5 +
                   (0.030679554871999).*x2.^5.*y2.^6 + (0.0263750408403291).*x2.^5.*y2.^7 +
                   (0.0293448518869167).*x2.^4.*y2.^1 + (0.0230972514034103).*x2.^4.*y2.^2 +
                   (-0.232307481911892).*x2.^4.*y2.^3 + (-0.102766957962802).*x2.^4.*y2.^4 +
                   (0.165226159438051).*x2.^4.*y2.^5 + (0.0468397541038271).*x2.^4.*y2.^6 +
                   (-0.027205339050262).*x2.^4.*y2.^7 + (0.00722743669214316).*x2.^3.*y2.^1 +
                   (-0.0834976239420921).*x2.^3.*y2.^2 + (-0.0947683339785946).*x2.^3.*y2.^3 +
                    (0.128266195351322).*x2.^3.*y2.^4 + (0.112677187454975).*x2.^3.*y2.^5 +
                    (-0.0353616564101556).*x2.^3.*y2.^6 + (-0.0281203381521887).*x2.^3.*y2.^7 +
                    (-0.0577321476805478).*x2.^2.*y2.^1 + (-0.00529917338841401).*x2.^2.*y2.^2 +
                     (0.191914708599173).*x2.^2.*y2.^3 + (0.0282683906371302).*x2.^2.*y2.^4 +
                     (-0.147285981576142).*x2.^2.*y2.^5 + (-0.0173425133065822).*x2.^2.*y2.^6 +
                      (0.0283303265421487).*x2.^2.*y2.^7 + (0.0432160349546858).*x2.^1.*y2.^1 +
                      (0.0514986198028016).*x2.^1.*y2.^2 + (0.0355856091333069).*x2.^1.*y2.^3 +
                       (-0.036817044774667).*x2.^1.*y2.^4 + (-0.0284525605002739).*x2.^1.*y2.^5 +
                       (0.0156065386330833).*x2.^1.*y2.^6 + (0.010189574114693).*x2.^1.*y2.^7);
       elseif p < fitSCrSH then //SH
         x1 :=(p - 2.980358857267919e+06)/2.003389387197036e+06;
         y1 :=(T - 4.054229562317557e+02)/45.958409114606440;

         d:= 56.635211776407670 + 51.170196305935875 *
           (-0.155405407061141 + (0.858952978344348).*x1.^1 + (0.213288291210149).*x1.^2
           + (-0.0902939804954138).*x1.^3 + (-0.0775446256383539).*x1.^4 +
           (0.176073913408194).*x1.^5 + (0.076632784026947).*x1.^6 +
            (-0.0754392352663131).*x1.^7 + (-0.0168165605990865).*x1.^8 +
            (0.0119196239259754).*x1.^9 + (-0.24679776490568).*y1.^1 +
            (0.118452496083566).*y1.^2 + (0.058010861375621).*y1.^3 +
            (-0.125721755741676).*y1.^4 + (-0.0869548090944236).*y1.^5 +
            (0.151426848923125).*y1.^6 + (-0.00345027146128307).*y1.^7 +
            (-0.0380867550273735).*y1.^8 + (0.00770302229640823).*y1.^9 +
            (-0.000184356030018773).*y1.^10 + (0.00695003004458847).*y1.^9.*x1.^1 +
            (-0.10233644571842).*y1.^8.*x1.^1 + (-0.0574618220752893).*y1.^8.*x1.^2 +
            (0.205712953312401).*y1.^7.*x1.^1 + (0.387270894204892).*y1.^7.*x1.^2 +
             (0.172714228770193).*y1.^7.*x1.^3 + (0.237231827455007).*y1.^6.*x1.^1
             + (-0.381261125587045).*y1.^6.*x1.^2 + (-0.688016470590964).*y1.^6.*x1.^3
             + (-0.244367687983105).*y1.^6.*x1.^4 + (-0.807515143414528).*y1.^5.*x1.^1
             + (-0.963615374256844).*y1.^5.*x1.^2 + (0.345738162507936).*y1.^5.*x1.^3 +
              (0.76365527515375).*y1.^5.*x1.^4 + (0.203962115703852).*y1.^5.*x1.^5 +
              (0.260045573530793).*y1.^4.*x1.^1 + (1.72973599259557).*y1.^4.*x1.^2 +
              (1.46553662256924).*y1.^4.*x1.^3 + (-0.350716651246153).*y1.^4.*x1.^4 +
              (-0.598601071183006).*y1.^4.*x1.^5 + (-0.0998971840299521).*y1.^4.*x1.^6 +
               (0.445273288860043).*y1.^3.*x1.^1 + (-0.38718966280931).*y1.^3.*x1.^2 +
               (-2.07977216412435).*y1.^3.*x1.^3 + (-1.06940284008784).*y1.^3.*x1.^4 +
               (0.5303829417672).*y1.^3.*x1.^5 + (0.324669022252792).*y1.^3.*x1.^6 +
               (-0.0084090709705604).*y1.^3.*x1.^7 + (-0.0816405819198117).*y1.^2.*x1.^1 +
               (-0.53432536208958).*y1.^2.*x1.^2 + (0.555479825486614).*y1.^2.*x1.^3 +
                (1.45239969441888).*y1.^2.*x1.^4 + (0.229206711193164).*y1.^2.*x1.^5 +
                 (-0.450986392763636).*y1.^2.*x1.^6 + (-0.0771458804542199).*y1.^2.*x1.^7 +
                  (0.0377378900218081).*y1.^2.*x1.^8 + (-0.416239624689007).*y1.^1.*x1.^1 +
                  (0.0607974650064569).*y1.^1.*x1.^2 + (0.358387861018122).*y1.^1.*x1.^3 +
                  (-0.469572807008312).*y1.^1.*x1.^4 + (-0.579176416783071).*y1.^1.*x1.^5 +
                  (0.150532390667626).*y1.^1.*x1.^6 + (0.175128728652312).*y1.^1.*x1.^7 +
                  (-0.022779697731843).*y1.^1.*x1.^8 + (-0.0128793243342138).*y1.^1.*x1.^9);

       else //SCr
         x5 :=(p - 5.802288615661496e+06)/7.338554467075353e+05;
         y5 :=(T - 3.760304613091765e+02)/5.498810315188556;

         d := 3.154990120758517e+02 + 49.733110939377710 *
         (0.299869197337571 + (0.493544413999471).*x5.^1 +
          (-0.0779300918681101).*x5.^2 + (-0.0369374721172474).*x5.^3 +
          (-0.10061457957755).*x5.^4 + (0.127626523411747).*x5.^5 +
          (-0.0172983983999577).*x5.^6 + (-0.0106696518710035).*x5.^7 +
          (-0.585540913373924).*y5.^1 + (-0.079479379553719).*y5.^2 +
          (-0.0136219811833012).*y5.^3 + (-0.00768025967642203).*y5.^4 +
           (-0.00187125350315162).*y5.^5 + (-0.00225551457291989).*y5.^6 +
           (0.00090474924209334).*y5.^7 + (0.000860020641124224).*y5.^8 +
           (-0.00021525368295793).*y5.^9 + (-0.000657464733045406).*y5.^8.*x5.^1
           + (0.00250798430527033).*y5.^7.*x5.^1 + (-0.00139749959153795).*y5.^7.*x5.^2
            + (-0.00378145959721342).*y5.^6.*x5.^1 + (0.0023917407256004).*y5.^6.*x5.^2
            + (0.0014210653850692).*y5.^6.*x5.^3 + (-0.0211940323574041).*y5.^5.*x5.^1
            + (0.0419710052833225).*y5.^5.*x5.^2 + (-0.0345141444145719).*y5.^5.*x5.^3
             + (0.0102336499590255).*y5.^5.*x5.^4 + (0.0540520157437579).*y5.^4.*x5.^1
             + (-0.00530040370713783).*y5.^4.*x5.^2 + (-0.120399110797161).*y5.^4.*x5.^3
             + (0.116155307215779).*y5.^4.*x5.^4 + (-0.0328986900017651).*y5.^4.*x5.^5
              + (0.0719466714017369).*y5.^3.*x5.^1 + (-0.220349093449316).*y5.^3.*x5.^2
              + (0.194644432154442).*y5.^3.*x5.^3 + (0.112143753062631).*y5.^3.*x5.^4
               + (-0.207939873151493).*y5.^3.*x5.^5 + (0.0661011350517234).*y5.^3.*x5.^6
               + (0.00712110866024934).*y5.^2.*x5.^1 + (-0.12007589720659).*y5.^2.*x5.^2
               + (0.467647378385168).*y5.^2.*x5.^3 + (-0.363793709887983).*y5.^2.*x5.^4
               + (-0.0825155358614708).*y5.^2.*x5.^5 + (0.18402669084453).*y5.^2.*x5.^6
               + (-0.052121691943522).*y5.^2.*x5.^7 + (0.228762355770893).*y5.^1.*x5.^1
               + (0.0833950208016502).*y5.^1.*x5.^2 + (0.0103653721096735).*y5.^1.*x5.^3
                + (-0.511955626176765).*y5.^1.*x5.^4 + (0.320123104436571).*y5.^1.*x5.^5
                 + (0.113305973418153).*y5.^1.*x5.^6 + (-0.0863084965941776).*y5.^1.*x5.^7);

       end if;

    annotation(derivative(noDerivative=phase)=density_pT_der,
          inverse(p=pressure_dT(d=d,T=T,phase=phase)),
          Inline=false,
          LateInline=true);
  end density_pT;

  redeclare function extends dynamicViscosity
    "Calculates dynamic viscosity of refrigerant"

  protected
    Real tv[:] = {0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 2.0, 2.0,
                  2.0, 3.0, 4.0, 1.0, 2.0};
    Real dv[:] = {1.0, 2.0, 3.0, 13.0, 12.0, 16.0, 0.0, 18.0,
                  20.0, 13.0, 4.0, 0.0, 1.0};
    Real nv[:] = {-0.7548580e-1, 0.7607150, -0.1665680, 0.1627612e-5,
                  0.1443764e-4, -0.2759086e-6, -0.1032756, -0.2498159e-7,
                  0.4069891e-8, -0.1513434e-5, 0.2591327e-2, 0.5650076,
                  0.1207253};

    Real d_crit = MM/fluidConstants[1].criticalMolarVolume;
    Real MM = fluidConstants[1].molarMass;

    ThermodynamicState dewState = setDewState(setSat_T(state.T));
    ThermodynamicState bubbleState = setBubbleState(setSat_T(state.T));
    Real dr;
    Real drL;
    Real drG;
    Real etaL;
    Real etaG;
    Real Hc = 17.1045;
    Real Tr = state.T/fluidConstants[1].criticalTemperature;

    SaturationProperties sat = setSat_T(state.T);
    Real phase_dT = if not ((state.d < bubbleDensity(sat) and state.d >
      dewDensity(sat)) and state.T < fluidConstants[1].criticalTemperature)
      then 1 else 2;
    Real quality;

  algorithm
    if state.phase==1 or phase_dT==1 then
      eta := 0;
      dr := state.d/d_crit;
      for i in 1:11 loop
          eta := eta + nv[i]*Tr^tv[i]*dr^dv[i];
      end for;
      for i in 12:13 loop
          eta := eta + exp(-dr*dr/2)*nv[i]*Tr^tv[i]*dr^dv[i];
      end for;
      eta := (exp(eta) - 1)*Hc/1e6;
    elseif state.phase==2 or phase_dT==2 then
      etaL := 0;
      etaG := 0;
      drG := dewState.d/d_crit;
      drL := bubbleState.d/d_crit;
      quality :=if state.phase == 2 then (bubbleState.d/state.d - 1)/(
      bubbleState.d/dewState.d - 1) else 1;
      for i in 1:11 loop
          etaL := etaL + nv[i]*Tr^tv[i]*drL^dv[i];
          etaG := etaG + nv[i]*Tr^tv[i]*drG^dv[i];
      end for;
      for i in 12:13 loop
          etaL := etaL + exp(-drL*drL/2)*nv[i]*Tr^tv[i]*drL^dv[i];
          etaG := etaG + exp(-drG*drG/2)*nv[i]*Tr^tv[i]*drG^dv[i];
      end for;
      etaL := (exp(etaL) - 1)*Hc/1e6;
      etaG := (exp(etaG) - 1)*Hc/1e6;
      eta := (quality/etaG + (1 - quality)/etaL)^(-1);
    end if;
  end dynamicViscosity;

  redeclare function extends thermalConductivity
    "Calculates thermal conductivity of refrigerant"

  protected
    Real B1[:] = {-3.51153e-2,1.70890e-1,-1.47688e-1,5.19283e-2,-6.18662e-3};
    Real B2[:] = {4.69195e-2,-1.48616e-1,1.32457e-1,-4.85636e-2,6.60414e-3};
    Real C[:] = {3.66486e-4,-2.21696e-3,2.64213e+0};
    Real A[:] = {-1.24778e-3,8.16371e-3,1.99374e-2};

    Real d_crit = MM/fluidConstants[1].criticalMolarVolume;
    Real MM = fluidConstants[1].molarMass;

    Real delta;
    Real deltaL;
    Real deltaG;
    Real tau = fluidConstants[1].criticalTemperature/state.T;

    Real lambda0 = A[1]+A[2]/tau+A[3]/(tau^2);
    Real lambdar = 0;
    Real lambdarL = 0;
    Real lambdarG = 0;
    Real lambdaL = 0;
    Real lambdaG = 0;

    SaturationProperties sat = setSat_T(state.T);
    Real phase_dT = if not ((state.d < bubbleDensity(sat) and state.d >
      dewDensity(sat)) and state.T < fluidConstants[1].criticalTemperature)
      then 1 else 2;
    Real quality;

  algorithm
    delta :=state.d/d_crit;
    if state.phase==1 or phase_dT==1 then
      for i in 1:5 loop
          lambdar := lambdar + (B1[i] + B2[i]/tau)*delta^i;
      end for;
      lambda := (lambda0 + lambdar + (C[1]/(C[2] + abs(1.0/tau - 1.0))*
        exp(-(C[3]*(delta - 1.0))^2)));
    elseif state.phase==2 or phase_dT==2 then
      deltaL :=bubbleDensity(setSat_T(state.T))/d_crit;
      deltaG :=dewDensity(setSat_T(state.T))/d_crit;
      quality :=if state.phase == 2 then (bubbleDensity(setSat_T(state.T))/
        state.d - 1)/(bubbleDensity(setSat_T(state.T))/dewDensity(setSat_T(
        state.T)) - 1) else 1;
      for i in 1:5 loop
          lambdarL := lambdarL + (B1[i] + B2[i]/tau)*deltaL^i;
          lambdarG := lambdarG + (B1[i] + B2[i]/tau)*deltaG^i;
      end for;
      lambdaL := (lambda0 + lambdarL + (C[1]/(C[2] + abs(1.0/tau - 1.0))*
        exp(-(C[3]*(deltaL - 1.0))^2)));
      lambdaG := (lambda0 + lambdarG + (C[1]/(C[2] + abs(1.0/tau - 1.0))*
        exp(-(C[3]*(deltaG - 1.0))^2)));
      lambda := (quality/lambdaG + (1 - quality)/lambdaL)^(-1);
    end if;
  end thermalConductivity;

  redeclare function extends surfaceTension
    "Surface tension in two phase region of refrigerant"

  algorithm
    //sigma := 1e-3*55.817*(1-sat.Tsat/369.85)^1.266; //stimmt die überhaupt?? (unten neu eingefügt)
    sigma := 0.05334 * (1-sat.Tsat/369.89)^(1.235) + (-0.01748) * (1-sat.Tsat/369.89)^(4.404);
  end surfaceTension;
  annotation (Documentation(revisions="<html>
<ul>
<li>October, 2019, by :<br>First implementation (see <a href=\"https://github.com/RWTH-EBC/AixLib/issues/408\">issue 408</a>). </li>
</ul>
</html>", info="<html>
<p>This package provides a refrigerant model for R290 using a hybrid approach developed by Sangi et al.. The hybrid approach is implemented in <a href=\"modelica://AixLib.Media.Refrigerants.Interfaces.PartialHybridTwoPhaseMediumRecord\">AixLib.Media.Refrigerants.Interfaces.PartialHybridTwoPhaseMediumRecord </a>and the refrigerant model is implemented by complete the template <a href=\"modelica://AixLib.Media.Refrigerants.Interfaces.TemplateHybridTwoPhaseMediumRecord\">AixLib.Media.Refrigerants.Interfaces.TemplateHybridTwoPhaseMediumRecord </a>. </p>
<h4>Assumptions and limitations</h4>
<p><br>The implemented coefficients are fitted to external data by Sangi et al. and are valid within the following range:</p>
<table cellspacing=\"0\" cellpadding=\"2\" border=\"1\" width=\"30%\"><tr>
<td><p>Parameter</p></td>
<td><p>Minimum Value</p></td>
<td><p>Maximum Value</p></td>
</tr>
<tr>
<td><p>Pressure (p) in bar</p></td>
<td><p>1.0</p></td>
<td><p>70</p></td>
</tr>
<tr>
<td><p>Temperature (T) in K</p></td>
<td><p>233.15</p></td>
<td><p>473.15</p></td>
</tr>
</table>
<p><br><h4>Validation</h4></p>
<p>Sangi et al. validated their model by comparing it to results obtained from the Helmholtz equation of state. They found out that relative error of the refrigerant model compared to HelmholtzMedia (Thorade and Saadat, 2012) is close to zero. </p>
<h4>References</h4>
<p>Thorade, Matthis; Saadat, Ali (2012): <a href=\"http://www.ep.liu.se/ecp/076/006/ecp12076006.pdf\">HelmholtzMedia - A fluid properties library</a>. In: <i>Proceedings of the 9th International Modelica Conference</i>; September 3-5; 2012; Munich; Germany. Link&ouml;ping University Electronic Press, S. 63&ndash;70. </p>
<p>Sangi, Roozbeh; Jahangiri, Pooyan; Klasing, Freerk; Streblow, Rita; M&uuml;ller, Dirk (2014): <a href=\"http://dx.doi.org/10.3384/ecp14096\">A Medium Model for the Refrigerant Propane for Fast and Accurate Dynamic Simulations</a>. In: <i>The 10th International Modelica Conference</i>. Lund, Sweden, March 10-12, 2014: Link&ouml;ping University Electronic Press (Link&ouml;ping Electronic Conference Proceedings), S. 1271&ndash;1275 </p>
<p>Klasing,Freerk: A New Design for Direct Exchange Geothermal Heat Pumps - Modeling, Simulation and Exergy Analysis. <i>Master thesis</i> </p>
<p>Scalabrin, G.; Marchi, P.; Span, R. (2006): A Reference Multiparameter Viscosity Equation for Propane with an Optimized Functional Form. In: <i>J. Phys. Chem. Ref. Data, Vol. 35, No. 3</i>, S. 1415-1442 </p>
</html>"));
end R290_new_IIR_P05_30_T263_343_Formula;
